# 儿童产品设计助手 - 数据库架构总览

## 概述

本项目采用**混合存储策略**，结合 Room 数据库（持久化）与静态数据库对象（内存访问），以满足不同的业务需求：
- **Room 数据库**：存储需要持久化和复杂查询的实体数据，如用户数据、测试记录、品牌信息等
- **静态数据库对象**：存储相对固定的标准数据和配置参数，以提高访问速度

---

## 数据库架构图

```
┌─────────────────────────────────────────────────────────────────────┐
│                        儿童产品设计助手数据库                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                   Room 数据库（持久化）                        │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │   │
│  │  │ EceR129      │  │ HighChair    │  │ Crib         │      │   │
│  │  │ Database     │  │ Database     │  │ Database     │      │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘      │   │
│  │                                                              │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │   │
│  │  │ FMVSS        │  │ Brand        │  │ GPS028       │      │   │
│  │  │ Database     │  │ Database     │  │ Database     │      │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘      │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │              静态数据库对象（内存访问）                        │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │   │
│  │  │ EceR129      │  │ HighChair    │  │ Crib         │      │   │
│  │  │ Standard     │  │ Standard     │  │ Standard     │      │   │
│  │  │ Database     │  │ Database     │  │ Database     │      │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘      │   │
│  │                                                              │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │   │
│  │  │ FMVSS        │  │ Brand        │  │ GPS028       │      │   │
│  │  │ Database     │  │ Database     │  │ Standard     │      │   │
│  │  └──────────────┘  └──────────────┘  │ Database     │      │   │
│  │                                            └──────────────┘      │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘
```

---

## Room 数据库列表

### 1. EceR129Database (ECE R129 i-Size 欧洲儿童安全座椅标准)

**文件路径**: `app/src/main/java/com/childproduct/designassistant/database/EceR129Database.kt`

**用途**: 存储 ECE R129 标准相关的持久化数据

**实体**:
- `EceR129StandardEntity` - 标准基本信息
- `EceR129DummyEntity` - 假人信息
- `EceR129TestMatrixEntity` - 测试矩阵
- `EceR129TestRecordEntity` - 测试记录

**DAO**: `EceR129Dao`

**使用场景**: 
- ECE R129 标准数据查询和管理
- 测试记录持久化
- 产品测试结果跟踪

---

### 2. HighChairDatabase (高脚椅数据库)

**文件路径**: `app/src/main/java/com/childproduct/designassistant/database/HighChairDatabase.kt`

**用途**: 存储高脚椅相关的持久化数据

**实体**:
- `HighChairStandardEntity` - 高脚椅标准信息
- `HighChairProductEntity` - 高脚椅产品信息

**DAO**: `HighChairDao`

**使用场景**:
- 高脚椅产品信息管理
- 高脚椅标准数据查询
- 产品测试结果记录

---

### 3. CribDatabase (儿童床数据库)

**文件路径**: `app/src/main/java/com/childproduct/designassistant/database/CribDatabase.kt`

**用途**: 存储儿童床相关的持久化数据

**实体**:
- `CribStandardEntity` - 儿童床标准信息
- `CribProductEntity` - 儿童床产品信息

**DAO**: `CribDao`

**使用场景**:
- 儿童床产品信息管理
- 儿童床标准数据查询
- 产品测试结果记录

---

### 4. FMVSSDatabase (FMVSS 213/213a 美国联邦机动车安全标准)

**文件路径**: `app/src/main/java/com/childproduct/designassistant/database/FMVSSDatabase.kt`

**用途**: 存储 FMVSS 213/213a 标准相关的持久化数据

**实体**:
- `FMVSSStandardEntity` - FMVSS标准信息
- `FMVSSDummyEntity` - FMVSS假人信息
- `FMVSSTestConfigEntity` - 测试配置
- `FMVSSThresholdEntity` - 安全阈值
- `FMVSSTestRecordEntity` - 测试记录
- `FMVSSProductTestEntity` - 产品测试信息

**DAO**: `FMVSSDao`

**使用场景**:
- FMVSS 213/213a 标准数据查询和管理
- 测试配置和阈值管理
- 产品测试结果和认证信息跟踪

---

### 5. BrandDatabase (品牌数据库)

**文件路径**: `app/src/main/java/com/childproduct/designassistant/database/BrandDatabase.kt`

**用途**: 存储品牌产品信息和参数

**实体**:
- `BrandProductEntity` - 品牌产品基本信息
- `BrandParameterEntity` - 产品技术参数
- `BrandFeatureEntity` - 产品特色功能
- `BrandComplianceEntity` - 产品合规性信息
- `BrandReviewEntity` - 用户评价
- `BrandComparisonEntity` - 产品对比数据

**DAO**: `BrandDao`

**使用场景**:
- 品牌产品信息管理
- 产品参数和功能对比
- 合规性信息跟踪
- 用户评价收集和分析

---

### 6. GPS028Database (GB 28007 GPS028 静态数据库)

**文件路径**: `app/src/main/java/com/childproduct/designassistant/database/GPS028Database.kt`

**用途**: 存储 GPS028 标准数据（主要是静态数据）

**实体**: N/A (静态数据)

**DAO**: N/A

**使用场景**: GPS028 标准查询

---

## 静态数据库对象列表

### 1. EceR129StandardDatabase

**文件路径**: `app/src/main/java/com/childproduct/designassistant/data/EceR129StandardDatabase.kt`

**用途**: 存储 ECE R129 标准的静态数据，便于快速访问

**包含内容**:
- 标准基本信息
- Q系列假人规格（Q0, Q1, Q1.5, Q3, Q6, Q10）
- 测试矩阵和碰撞参数
- 伤害指标（HIC36, HIC15, 胸部加速度等）
- 尺寸阈值
- 假人重量/身高映射

**查询方法**:
- `getStandardInfo()` - 获取标准信息
- `getAllDummySpecs()` - 获取所有假人规格
- `getDummiesByWeightRange()` - 根据重量范围获取假人
- `getDummiesByHeightRange()` - 根据身高范围获取假人
- `getInjuryCriteriaByDummy()` - 获取假人的伤害指标
- `getDimensionThresholdsByDummy()` - 获取假人的尺寸阈值

---

### 2. HighChairStandardDatabase

**文件路径**: `app/src/main/java/com/childproduct/designassistant/data/HighChairStandardDatabase.kt`

**用途**: 存储高脚椅标准的静态数据

**包含内容**:
- 多个标准的基本信息（EN 14988-1, ASTM F404, GB 22793.1, EN 16120, AS 4684）
- 稳定性数据（前向、后向、侧向测试）
- 约束系统数据（三点式、五点式约束带）
- 结构强度数据（座面载荷、托盘载荷、冲击测试）

**查询方法**:
- `getAllStandards()` - 获取所有标准信息
- `getStabilityDataByStandard()` - 获取标准的稳定性数据
- `getRestraintDataByStandard()` - 获取标准的约束系统数据
- `getStructuralStrengthDataByStandard()` - 获取标准的结构强度数据

---

### 3. CribStandardDatabase

**文件路径**: `app/src/main/java/com/childproduct/designassistant/data/CribStandardDatabase.kt`

**用途**: 存储儿童床标准的静态数据

**包含内容**:
- 多个标准的基本信息（EN 1130, ASTM F1169, ASTM F1821, GB/T 33266, AS/NZS 2172）
- 尺寸数据（长度、宽度、护栏高度）
- 栏杆数据（竖杆间距、强度）
- 凸起数据（高度、直径限制）
- 床垫数据（厚度、间隙限制）

**查询方法**:
- `getAllStandards()` - 获取所有标准信息
- `getDimensionDataByStandard()` - 获取标准的尺寸数据
- `getSlatDataByStandard()` - 获取标准的栏杆数据
- `getProtrusionDataByStandard()` - 获取标准的凸起数据
- `getMattressDataByStandard()` - 获取标准的床垫数据

---

### 4. FMVSSDatabase (静态对象)

**文件路径**: `app/src/main/java/com/childproduct/designassistant/data/FMVSSDatabase.kt`

**用途**: 存储 FMVSS 213/213a 标准的静态数据

**包含内容**:
- FMVSS 213/213a 标准基本信息
- FMVSS 假人类型（CRABI 6/12/18, Hybrid III 3Y/6Y, Q3s）
- 测试配置（正面碰撞、侧面碰撞）
- 安全阈值（HIC36, HIC15, 胸部加速度）
- 标准分组和假人匹配规则
- 材料要求

**查询方法**:
- `getAllStandards()` - 获取所有标准信息
- `getAllGroups()` - 获取所有分组
- `getDummiesByWeightRange()` - 根据重量范围获取假人
- `getDummiesByAgeRange()` - 根据年龄范围获取假人
- `getThresholdsByDummy()` - 获取假人的安全阈值

---

### 5. BrandDatabase (静态对象)

**文件路径**: `app/src/main/java/com/childproduct/designassistant/data/BrandDatabase.kt`

**用途**: 存储品牌参数的静态数据（已转为Room数据库）

**包含内容**: 已迁移到 Room 数据库

---

### 6. GPS028StandardDatabase (静态对象)

**文件路径**: `app/src/main/java/com/childproduct/designassistant/data/GPS028StandardDatabase.kt`

**用途**: 存储 GPS028 标准的静态数据

**包含内容**:
- GPS028 标准基本信息
- 假人规格和测试矩阵
- 材料要求

**查询方法**:
- `getStandardInfo()` - 获取标准信息
- `getStabilityData()` - 获取稳定性数据

---

## 数据库使用指南

### 何时使用 Room 数据库？

- 需要持久化数据（如用户保存的产品、测试记录）
- 需要复杂查询和关联操作
- 数据量较大，需要索引优化
- 需要事务支持

### 何时使用静态数据库对象？

- 数据相对固定，不频繁变更
- 需要快速访问
- 标准数据和配置参数
- 内存占用较小

### Room 数据库初始化示例

```kotlin
// 在 Application 或 Hilt 模块中初始化
@Provides
@Singleton
fun provideEceR129Database(@ApplicationContext context: Context): EceR129Database {
    return Room.databaseBuilder(
        context,
        EceR129Database::class.java,
        EceR129Database.DATABASE_NAME
    ).build()
}

@Provides
@Singleton
fun provideFMVSSDatabase(@ApplicationContext context: Context): FMVSSDatabase {
    return Room.databaseBuilder(
        context,
        FMVSSDatabase::class.java,
        FMVSSDatabase.DATABASE_NAME
    ).build()
}

@Provides
@Singleton
fun provideBrandDatabase(@ApplicationContext context: Context): BrandDatabase {
    return Room.databaseBuilder(
        context,
        BrandDatabase::class.java,
        BrandDatabase.DATABASE_NAME
    ).build()
}
```

### 静态数据库对象使用示例

```kotlin
// 直接访问静态数据
val standardInfo = EceR129StandardDatabase.STANDARD_INFO
val dummySpecs = EceR129StandardDatabase.getAllDummySpecs()
val stabilityData = HighChairStandardDatabase.getStabilityDataByStandard("EN 14988-1")
```

---

## 数据库依赖关系

```
StandardRepository
    ├── EceR129Database (Room)
    ├── HighChairDatabase (Room)
    ├── CribDatabase (Room)
    ├── FMVSSDatabase (Room)
    ├── BrandDatabase (Room)
    ├── GPS028Database (Room)
    ├── EceR129StandardDatabase (Static)
    ├── HighChairStandardDatabase (Static)
    ├── CribStandardDatabase (Static)
    ├── FMVSSDatabase (Static)
    └── GPS028StandardDatabase (Static)
```

---

## 版本历史

- **v1.0**: 初始架构，单一 EceR129Database
- **v2.0**: 拆分为 EceR129、HighChair、Crib 三个独立数据库
- **v3.0**: 添加 FMVSSDatabase、BrandDatabase Room 数据库
- **v3.1**: 添加 EceR129StandardDatabase、HighChairStandardDatabase、CribStandardDatabase 静态对象
- **v3.2**: 添加 FMVSSDatabase 静态对象

---

## 后续优化建议

1. **数据同步机制**: 静态数据库对象与 Room 数据库之间的数据同步
2. **数据迁移策略**: 数据库版本升级时的迁移脚本
3. **缓存策略**: 频繁访问的数据缓存机制
4. **索引优化**: 根据查询模式优化数据库索引
5. **数据导出/导入**: 支持数据的导出和导入功能

---

## 联系方式

如有问题或建议，请联系开发团队。
