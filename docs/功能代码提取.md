# å„¿ç«¥äº§å“è®¾è®¡åŠ©æ‰‹ - å…¨éƒ¨åŠŸèƒ½ä»£ç æå–

> æå–æ—¶é—´ï¼š2025-01-08
> é¡¹ç›®ç‰ˆæœ¬ï¼šåŸºäºJetpack Composeçš„å„¿ç«¥äº§å“è®¾è®¡åŠ©æ‰‹
> æå–èŒƒå›´ï¼šæ ¸å¿ƒåŠŸèƒ½ä»£ç æ¨¡å—

---

## ğŸ“‹ ç›®å½•

1. [æ•°æ®æ¨¡å‹å±‚](#æ•°æ®æ¨¡å‹å±‚)
2. [å·¥å…·ç±»å±‚](#å·¥å…·ç±»å±‚)
3. [æœåŠ¡å±‚](#æœåŠ¡å±‚)
4. [UIå±‚](#uiå±‚)
5. [å¸ƒå±€æ–‡ä»¶](#å¸ƒå±€æ–‡ä»¶)

---

## ğŸ—‚ï¸ æ•°æ®æ¨¡å‹å±‚

### 1. å®‰è£…æ–¹å¼æšä¸¾ (InstallMethod.kt)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/childproduct/designassistant/model/InstallMethod.kt`

```kotlin
package com.childproduct.designassistant.model

/**
 * å®‰è£…æ–¹å¼æšä¸¾ï¼ˆç”¨æˆ·å¯é€‰æ‹©çš„é€‰é¡¹ï¼Œä¸UIå•é€‰æŒ‰é’®å¯¹åº”ï¼‰
 */
enum class InstallMethod(
    val displayName: String,  // UIæ˜¾ç¤ºåç§°
    val description: String   // æ ¸å¿ƒç‰¹ç‚¹ä¸­çš„æè¿°æ–‡æœ¬
) {
    ISOFIX(
        displayName = "ISOFIXå¿«é€Ÿè¿æ¥",
        description = "ISOFIXå¿«é€Ÿè¿æ¥ï¼ˆæ— é˜²æ—‹è½¬è£…ç½®ï¼‰"
    ),
    ISOFIX_TOP_TETHER(
        displayName = "ISOFIX + Top-tether",
        description = "ISOFIXå¿«é€Ÿè¿æ¥ + Top-tetheré˜²æ—‹è½¬ï¼ˆä¸Šæ‹‰å¸¦ï¼‰"
    ),
    ISOFIX_SUPPORT_LEG(
        displayName = "ISOFIX + æ”¯æ’‘è…¿",
        description = "ISOFIXå¿«é€Ÿè¿æ¥ + æ”¯æ’‘è…¿é˜²æ—‹è½¬ï¼ˆåº•éƒ¨æ”¯æ’‘ï¼‰"
    ),
    SEAT_BELT(
        displayName = "è½¦è¾†å®‰å…¨å¸¦å›ºå®š",
        description = "è½¦è¾†ä¸‰ç‚¹å¼å®‰å…¨å¸¦å›ºå®šï¼ˆæ— é˜²æ—‹è½¬è£…ç½®ï¼‰"
    ),
    SEAT_BELT_TOP_TETHER(
        displayName = "å®‰å…¨å¸¦ + Top-tether",
        description = "è½¦è¾†å®‰å…¨å¸¦å›ºå®š + Top-tetheré˜²æ—‹è½¬ï¼ˆä¸Šæ‹‰å¸¦ï¼‰"
    )
}
```

---

### 2. æµ‹è¯•çŸ©é˜µæ¨¡å‹ (TestMatrix.kt)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/childproduct/designassistant/model/TestMatrix.kt`

```kotlin
package com.childproduct.designassistant.model

/**
 * æµ‹è¯•çŸ©é˜µå•é¡¹æ¨¡å‹ï¼ˆå‚ç…§ROADMATE 360æ ¼å¼ï¼Œå«æ ‡å‡†å…³è”ï¼‰
 */
data class TestMatrixItem(
    val testItem: String,        // æµ‹è¯•é¡¹ç›®ï¼ˆå¦‚ï¼šHICæé™å€¼ï¼‰
    val standardRequirement: String, // æ ‡å‡†è¦æ±‚ï¼ˆå¦‚ï¼šâ‰¤390/â‰¤1000ï¼‰
    val applicableDummy: String, // é€‚ç”¨å‡äººï¼ˆå¦‚ï¼šQ0-Q1.5/Q3-Q10ï¼‰
    val unit: String,            // å•ä½ï¼ˆå¦‚ï¼šgã€Nã€mmï¼‰
    val standardSource: String   // æ ‡å‡†æ¥æºï¼ˆå¦‚ï¼šECE R129 Â§7.1.2ï¼‰
)
```

---

### 3. æ ‡å‡†åŒ–è®¾è®¡æ–¹æ¡ˆæ¨¡å‹ (ChildProductDesignScheme.kt)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/childproduct/designassistant/model/ChildProductDesignScheme.kt`

```kotlin
package com.childproduct.designassistant.model

/**
 * æ ‡å‡†åŒ–è®¾è®¡æ–¹æ¡ˆæ•°æ®æ¨¡å‹ï¼ˆæ›¿ä»£æ‚ä¹±ä»£ç å­—æ®µï¼Œæ¶ˆé™¤ä¹±ç /å†—ä½™æ ¹æºï¼‰
 *
 * æ ¸å¿ƒä¼˜åŒ–ï¼š
 * - ä½¿ç”¨ç»“æ„åŒ–å­—æ®µæ›¿ä»£ä»£ç å¼å­—ç¬¦ä¸²
 * - å¼ºåˆ¶ä½¿ç”¨æ ‡å‡†å€¼ï¼ˆå¦‚å¹´é¾„æ®µã€å‡äººç±»å‹ï¼‰
 * - æ‰€æœ‰åˆ—è¡¨å­—æ®µè‡ªåŠ¨å»é‡
 * - æ–°å¢å®‰è£…æ–¹å¼å’Œæµ‹è¯•çŸ©é˜µå­—æ®µ
 */
data class ChildProductDesignScheme(
    // ========== åŸºæœ¬ä¿¡æ¯ ==========
    val productType: String,                    // äº§å“ç±»å‹ï¼ˆå¦‚ï¼šå„¿ç«¥å®‰å…¨åº§æ¤…ï¼‰
    val heightRange: String,                   // èº«é«˜èŒƒå›´ï¼ˆå¦‚ï¼š40-150cmï¼‰
    val ageRange: String,                      // é€‚é…å¹´é¾„æ®µï¼ˆæ ‡å‡†å€¼ï¼‰
    val designTheme: String,                   // è®¾è®¡ä¸»é¢˜ï¼ˆå¦‚ï¼šæ‹¼å›¾æ¸¸æˆï¼‰

    // ========== æ ¸å¿ƒè®¾è®¡ ==========
    val installMethodDesc: String,             // å®‰è£…æ–¹å¼æè¿°ï¼ˆè”åŠ¨InstallMethodï¼‰
    val coreFeatures: List<String>,            // æ ¸å¿ƒç‰¹ç‚¹ï¼ˆå»é‡åï¼‰
    val recommendMaterials: List<String>,      // æ¨èææ–™ï¼ˆå»é‡åï¼‰

    // ========== åˆè§„å‚æ•° ==========
    val complianceStandards: List<String>,     // åˆè§„æ ‡å‡†ï¼ˆå»é‡åï¼‰
    val dummyType: String,                     // é€‚é…å‡äººç±»å‹ï¼ˆæ ‡å‡†å€¼ï¼‰
    val safetyThresholds: Map<String, String>, // å®‰å…¨é˜ˆå€¼ï¼ˆæ— é‡å¤ï¼‰
    val testMatrix: List<TestMatrixItem>,      // æµ‹è¯•çŸ©é˜µï¼ˆç»“æ„åŒ–ï¼‰

    // ========== å®‰å…¨æç¤º ==========
    val safetyNotes: List<String>              // å®‰å…¨æ³¨æ„äº‹é¡¹ï¼ˆå»é‡åï¼‰
) {
    /**
     * éªŒè¯æ•°æ®å®Œæ•´æ€§
     */
    fun validate(): ValidationResult {
        val errors = mutableListOf<String>()

        if (productType.isEmpty()) errors.add("äº§å“ç±»å‹ä¸èƒ½ä¸ºç©º")
        if (heightRange.isEmpty()) errors.add("èº«é«˜èŒƒå›´ä¸èƒ½ä¸ºç©º")
        if (ageRange.isEmpty()) errors.add("å¹´é¾„æ®µä¸èƒ½ä¸ºç©º")
        if (coreFeatures.isEmpty()) errors.add("æ ¸å¿ƒç‰¹ç‚¹ä¸èƒ½ä¸ºç©º")
        if (recommendMaterials.isEmpty()) errors.add("æ¨èææ–™ä¸èƒ½ä¸ºç©º")
        if (complianceStandards.isEmpty()) errors.add("åˆè§„æ ‡å‡†ä¸èƒ½ä¸ºç©º")
        if (dummyType.isEmpty()) errors.add("å‡äººç±»å‹ä¸èƒ½ä¸ºç©º")
        if (safetyThresholds.isEmpty()) errors.add("å®‰å…¨é˜ˆå€¼ä¸èƒ½ä¸ºç©º")
        if (safetyNotes.isEmpty()) errors.add("å®‰å…¨æ³¨æ„äº‹é¡¹ä¸èƒ½ä¸ºç©º")

        return ValidationResult(
            isValid = errors.isEmpty(),
            errors = errors
        )
    }

    /**
     * éªŒè¯ç»“æœ
     */
    data class ValidationResult(
        val isValid: Boolean,
        val errors: List<String>
    )
}
```

---

### 4. ç”¨æˆ·è¾“å…¥æ¨¡å‹ (UserInput.kt)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/childproduct/designassistant/model/UserInput.kt`

```kotlin
package com.childproduct.designassistant.model

import com.childproduct.designassistant.model.ProductType.*
import com.childproduct.designassistant.model.InternationalStandard.*
import com.childproduct.designassistant.model.UsageScenario

/**
 * ç”¨æˆ·è¾“å…¥æ•°æ® - å„¿ç«¥å®‰å…¨åº§æ¤…
 * æ”¯æŒæç®€è¾“å…¥ï¼šä»…éœ€èº«é«˜æˆ–é‡é‡èŒƒå›´ï¼Œç³»ç»Ÿè‡ªåŠ¨åŒ¹é…æ ‡å‡†
 */
data class SafetySeatInput(
    // åŸºæœ¬ä¿¡æ¯ï¼ˆç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«ï¼Œç”¨æˆ·å¯é€‰ï¼‰
    val standard: InternationalStandard? = null,
    val subtype: SafetySeatSubtype? = null,

    // æ ¸å¿ƒå‚æ•°ï¼ˆä»…éœ€è¾“å…¥å…¶ä¸€ï¼‰
    val heightRange: String? = null,  // èº«é«˜èŒƒå›´ï¼Œå¦‚ "60-105cm"ï¼ˆä¼˜å…ˆï¼‰
    val weightRange: String? = null,  // é‡é‡èŒƒå›´ï¼Œå¦‚ "9-18kg" æˆ– "22-40lb"
    val ageGroup: AgeGroup? = null,   // å¹´é¾„ç»„ï¼ˆå¯é€‰ï¼‰

    // ç‰¹å¾é€‰æ‹©ï¼ˆå¯é€‰ï¼‰
    val customFeatures: List<String> = emptyList(),

    // ä¸“é¡¹éœ€æ±‚ï¼ˆå¯é€‰ï¼‰
    val specificRequirements: List<String> = emptyList(),

    // é¢å¤–ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
    val customNotes: String? = null,

    // æç®€è¾“å…¥æ ‡è¯†
    val isSimplifiedInput: Boolean = true
)

/**
 * ç”¨æˆ·è¾“å…¥æ•°æ® - å©´å„¿æ¨è½¦
 * æ”¯æŒæç®€è¾“å…¥ï¼šä»…éœ€æ‰¿é‡èŒƒå›´ï¼Œç³»ç»Ÿè‡ªåŠ¨åŒ¹é…æ ‡å‡†
 */
data class StrollerInput(
    // åŸºæœ¬ä¿¡æ¯ï¼ˆç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«ï¼Œç”¨æˆ·å¯é€‰ï¼‰
    val standard: InternationalStandard? = null,
    val subtype: StrollerSubtype? = null,

    // æ ¸å¿ƒå‚æ•°
    val weightCapacityRange: String? = null,  // æ‰¿é‡èŒƒå›´ï¼Œå¦‚ "0-15kg"ï¼ˆå¿…éœ€ï¼‰
    val foldedDimensions: String? = null,      // æŠ˜å åå°ºå¯¸é™åˆ¶ï¼Œå¦‚ "50Ã—30Ã—20cm"ï¼ˆå¯é€‰ï¼‰
    val usageScenario: UsageScenario? = null,  // ä½¿ç”¨åœºæ™¯ï¼ˆå¯é€‰ï¼‰

    // ç‰¹å¾é€‰æ‹©ï¼ˆå¯é€‰ï¼‰
    val customFeatures: List<String> = emptyList(),

    // ä¸“é¡¹éœ€æ±‚ï¼ˆå¯é€‰ï¼‰
    val specificRequirements: List<String> = emptyList(),

    // é¢å¤–ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
    val customNotes: String? = null,

    // æç®€è¾“å…¥æ ‡è¯†
    val isSimplifiedInput: Boolean = true
)

/**
 * ç”¨æˆ·è¾“å…¥æ•°æ® - å„¿ç«¥å®¶åº­ç”¨å“
 */
data class HouseholdGoodInput(
    // åŸºæœ¬ä¿¡æ¯
    val productCategory: String,
    
    // æ ¸å¿ƒå‚æ•°
    val targetAgeGroup: AgeGroup,
    val usageScenario: String,
    
    // ç‰¹å¾é€‰æ‹©
    val keyFeatures: List<String> = emptyList(),
    
    // ä¸“é¡¹éœ€æ±‚
    val specificRequirements: List<String> = emptyList(),
    
    // é¢å¤–ä¿¡æ¯
    val customNotes: String? = null
)

/**
 * ç»Ÿä¸€ç”¨æˆ·è¾“å…¥å®¹å™¨
 */
sealed class ProductInput {
    data class SafetySeat(val data: SafetySeatInput) : ProductInput()
    data class Stroller(val data: StrollerInput) : ProductInput()
    data class HouseholdGood(val data: HouseholdGoodInput) : ProductInput()
}

/**
 * è¾“å…¥æ ¡éªŒç»“æœ
 */
data class ValidationResult(
    val isValid: Boolean,
    val errors: List<ValidationError> = emptyList(),
    val warnings: List<ValidationWarning> = emptyList()
)

/**
 * æ ¡éªŒé”™è¯¯
 */
data class ValidationError(
    val field: String,
    val message: String,
    val severity: ErrorSeverity
)

/**
 * é”™è¯¯ä¸¥é‡ç¨‹åº¦
 */
enum class ErrorSeverity {
    CRITICAL,  // ä¸¥é‡é”™è¯¯ï¼Œå¿…é¡»ä¿®å¤
    ERROR,     // ä¸€èˆ¬é”™è¯¯
    WARNING    // è­¦å‘Š
}

/**
 * æ ¡éªŒè­¦å‘Š
 */
data class ValidationWarning(
    val field: String,
    val message: String,
    val suggestion: String?
)

/**
 * è¾“å…¥å†å²è®°å½•
 */
data class InputHistory(
    val id: String,
    val timestamp: Long,
    val productType: ProductType,
    val standard: InternationalStandard?,
    val summary: String,
    val inputData: ProductInput
)
```

---

### 5. åˆè§„å‚æ•°æ¨¡å‹ (ComplianceParameters.kt)

**å®šä¹‰åœ¨ CreativeIdea.kt ä¸­**

```kotlin
/**
 * åˆè§„å‚æ•°æ¨¡å‹
 * å­˜å‚¨å„¿ç«¥å®‰å…¨åº§æ¤…/å„¿ç«¥äº§å“çš„å…³é”®åˆè§„æŒ‡æ ‡
 */
data class ComplianceParameters(
    val dummyType: CrashTestDummy,    // å‡äººç±»å‹ï¼ˆæ–°å¢ï¼Œä½œä¸ºä¸»è¦åˆ¤æ–­ä¾æ®ï¼‰
    val hicLimit: Int = 1000,          // HIC (å¤´éƒ¨ä¼¤å®³å‡†åˆ™) æé™å€¼ï¼Œé»˜è®¤1000 (FMVSS 213æ ‡å‡†)
    val chestAccelerationLimit: Int = 55, // èƒ¸éƒ¨åŠ é€Ÿåº¦æé™ï¼Œé»˜è®¤55g
    val neckTensionLimit: Int = 1800,  // é¢ˆéƒ¨å¼ åŠ›æé™ï¼Œé»˜è®¤1800N
    val neckCompressionLimit: Int = 2200, // é¢ˆéƒ¨å‹ç¼©æé™ï¼Œé»˜è®¤2200N
    val headExcursionLimit: Int = 550, // å¤´éƒ¨ä½ç§»æé™ï¼Œé»˜è®¤550mm
    val kneeExcursionLimit: Int = 650, // è†éƒ¨ä½ç§»æé™ï¼Œé»˜è®¤650mm
    val chestDeflectionLimit: Int = 52 // èƒ¸éƒ¨ä½ç§»æé™ï¼Œé»˜è®¤52mm
) {
    companion object {
        /**
         * æ ¹æ®å‡äººç±»å‹è¿”å›ç²¾ç¡®å‚æ•°ï¼ˆåŸºäºUN R129æ ‡å‡†ï¼‰
         */
        fun getByDummy(dummyType: CrashTestDummy): ComplianceParameters {
            return when (dummyType) {
                // Q0/Q0+/Q1å‡äººï¼ˆ0-18ä¸ªæœˆï¼‰ï¼šæœ€ä¸¥æ ¼
                CrashTestDummy.Q0, CrashTestDummy.Q0_PLUS, CrashTestDummy.Q1 -> ComplianceParameters(
                    dummyType = dummyType,
                    hicLimit = 390,  // æœ€ä¸¥æ ¼
                    chestAccelerationLimit = 55,
                    neckTensionLimit = 1800,
                    neckCompressionLimit = 2200,
                    headExcursionLimit = 550,
                    kneeExcursionLimit = 650,
                    chestDeflectionLimit = 52
                )
                // Q1.5å‡äººï¼ˆ18-36ä¸ªæœˆï¼‰ï¼šä¸­ç­‰ä¸¥æ ¼
                CrashTestDummy.Q1_5 -> ComplianceParameters(
                    dummyType = dummyType,
                    hicLimit = 570,  // Q1.5ä¸“ç”¨æ ‡å‡†
                    chestAccelerationLimit = 55,
                    neckTensionLimit = 1800,
                    neckCompressionLimit = 2200,
                    headExcursionLimit = 550,
                    kneeExcursionLimit = 650,
                    chestDeflectionLimit = 52
                )
                // Q3/Q3så‡äººï¼ˆ3-12å²ï¼‰ï¼šæ ‡å‡†ä¸¥æ ¼åº¦
                CrashTestDummy.Q3, CrashTestDummy.Q3_S -> ComplianceParameters(
                    dummyType = dummyType,
                    hicLimit = 1000,  // Q3æ ‡å‡†
                    chestAccelerationLimit = 60,  // èƒ¸éƒ¨åŠ é€Ÿåº¦æ”¾å®½åˆ°60g
                    neckTensionLimit = 2000,  // é¢ˆéƒ¨å¼ åŠ›æ”¾å®½
                    neckCompressionLimit = 2500,  // é¢ˆéƒ¨å‹ç¼©æ”¾å®½
                    headExcursionLimit = 550,
                    kneeExcursionLimit = 650,
                    chestDeflectionLimit = 52
                )
                // Q6/Q10å‡äººï¼ˆ7å²ä»¥ä¸Šï¼‰ï¼šä¸¥æ ¼åº¦é€‚ä¸­
                CrashTestDummy.Q6, CrashTestDummy.Q10 -> ComplianceParameters(
                    dummyType = dummyType,
                    hicLimit = 1000,
                    chestAccelerationLimit = 60,
                    neckTensionLimit = 2000,
                    neckCompressionLimit = 2500,
                    headExcursionLimit = 550,
                    kneeExcursionLimit = 650,
                    chestDeflectionLimit = 52
                )
            }
        }
    }
}
```

---

### 6. ç¢°æ’æµ‹è¯•æ˜ å°„ (CrashTestMapping.kt)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/childproduct/designassistant/model/CrashTestMapping.kt`

```kotlin
package com.childproduct.designassistant.model

/**
 * ç¢°æ’æµ‹è¯•æ˜ å°„ç³»ç»Ÿ
 * æä¾›å‡†ç¡®çš„èº«é«˜-å‡äººç±»å‹-å¹´é¾„æ®µæ˜ å°„ï¼ŒåŸºäºUN R129/GB 27887-2024æ ‡å‡†
 */
object CrashTestMapping {

    /**
     * èº«é«˜æ®µåˆ°å‡äººç±»å‹çš„æ˜ å°„è¡¨
     * æ ¼å¼ï¼šèº«é«˜èŒƒå›´(cm) -> å‡äººç±»å‹
     */
    private val heightToDummyMap = listOf(
        HeightToDummyMapping(40, 50, CrashTestDummy.Q0, "Group 0+", "æ–°ç”Ÿå„¿"),
        HeightToDummyMapping(50, 60, CrashTestDummy.Q0_PLUS, "Group 0+", "å¤§å©´å„¿"),
        HeightToDummyMapping(60, 75, CrashTestDummy.Q1, "Group 0+/1", "å¹¼å„¿"),
        HeightToDummyMapping(75, 87, CrashTestDummy.Q1_5, "Group 1", "å­¦æ­¥å„¿ç«¥"),
        HeightToDummyMapping(87, 105, CrashTestDummy.Q3, "Group 2", "å­¦å‰å„¿ç«¥"),
        HeightToDummyMapping(105, 125, CrashTestDummy.Q3_S, "Group 2/3", "å„¿ç«¥"),
        HeightToDummyMapping(125, 145, CrashTestDummy.Q6, "Group 3", "å¤§é¾„å„¿ç«¥"),
        HeightToDummyMapping(145, 150, CrashTestDummy.Q10, "Group 3", "é’å°‘å¹´")
    )

    /**
     * èº«é«˜æ®µæ•°æ®ç±»
     */
    data class HeightToDummyMapping(
        val minHeightCm: Int,
        val maxHeightCm: Int,
        val dummyType: CrashTestDummy,
        val productGroup: String,
        val description: String
    )

    /**
     * æ ¹æ®èº«é«˜è·å–å¯¹åº”çš„å‡äººç±»å‹
     */
    fun getDummyByHeight(heightCm: Int): CrashTestDummy {
        return heightToDummyMap.find { mapping ->
            heightCm >= mapping.minHeightCm && heightCm < mapping.maxHeightCm
        }?.dummyType ?: when {
            heightCm < 40 -> CrashTestDummy.Q0
            heightCm >= 150 -> CrashTestDummy.Q10
            else -> CrashTestDummy.Q3
        }
    }

    /**
     * éªŒè¯èº«é«˜èŒƒå›´æ˜¯å¦ç¬¦åˆUN R129æ ‡å‡†
     */
    fun validateHeightRange(minHeightCm: Int, maxHeightCm: Int): ValidationResult {
        val errors = mutableListOf<String>()
        val warnings = mutableListOf<String>()

        if (minHeightCm >= maxHeightCm) {
            errors.add("æœ€å°èº«é«˜å¿…é¡»å°äºæœ€å¤§èº«é«˜")
        }

        if (minHeightCm < 40) {
            warnings.add("æœ€å°èº«é«˜${minHeightCm}cmä½äºUN R129æ ‡å‡†èŒƒå›´ï¼ˆ40cmï¼‰")
        }
        if (maxHeightCm > 150) {
            warnings.add("æœ€å¤§èº«é«˜${maxHeightCm}cmè¶…è¿‡UN R129æ ‡å‡†èŒƒå›´ï¼ˆ150cmï¼‰")
        }

        return ValidationResult(
            isValid = errors.isEmpty(),
            errors = errors,
            warnings = warnings
        )
    }
}
```

---

### 7. èº«é«˜-å¹´é¾„æ®µæ˜ å°„é…ç½® (HeightAgeMappingConfig.kt)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/childproduct/designassistant/model/HeightAgeMappingConfig.kt`

```kotlin
package com.childproduct.designassistant.model

/**
 * èº«é«˜-å¹´é¾„æ®µ-dummy é…ç½®
 * æ ¸å¿ƒæ˜ å°„è§„åˆ™ï¼šèº«é«˜40-150cm â†’ 0-12å²ï¼ˆé€‚é…Q0-Q10 dummyï¼‰
 */
object HeightAgeMappingConfig {

    /**
     * èº«é«˜åŒºé—´é…ç½®
     */
    data class HeightIntervalConfig(
        val minHeight: Double,      // æœ€å°èº«é«˜ï¼ˆcmï¼‰
        val maxHeight: Double,      // æœ€å¤§èº«é«˜ï¼ˆcmï¼‰
        val ageRange: String,       // å¹´é¾„æ®µæè¿°
        val minAgeMonths: Int,      // æœ€å°å¹´é¾„ï¼ˆæœˆï¼‰
        val maxAgeMonths: Int,      // æœ€å¤§å¹´é¾„ï¼ˆæœˆï¼‰
        val dummyType: CrashTestDummy,  // å¯¹åº”çš„å‡äººç±»å‹
        val installDirection: InstallDirection,  // å®‰è£…æ–¹å‘
        val standardRequirement: String  // æ ‡å‡†è¦æ±‚
    )

    /**
     * æ ¸å¿ƒæ˜ å°„è¡¨ï¼šèº«é«˜40-150cm â†’ 0-12å²ï¼ˆQ0-Q10ï¼‰
     */
    val HEIGHT_INTERVALS = listOf(
        HeightIntervalConfig(
            minHeight = 40.0,
            maxHeight = 60.0,
            ageRange = "0-1å²",
            minAgeMonths = 0,
            maxAgeMonths = 12,
            dummyType = CrashTestDummy.Q0,
            installDirection = InstallDirection.REARWARD,
            standardRequirement = "åå‘å®‰è£…å¼ºåˆ¶è¦æ±‚ã€HICâ‰¤750"
        ),
        HeightIntervalConfig(
            minHeight = 60.0,
            maxHeight = 75.0,
            ageRange = "1-2å²",
            minAgeMonths = 12,
            maxAgeMonths = 24,
            dummyType = CrashTestDummy.Q1,
            installDirection = InstallDirection.REARWARD,
            standardRequirement = "åå‘å®‰è£…å¼ºåˆ¶è¦æ±‚ã€HICâ‰¤750"
        ),
        HeightIntervalConfig(
            minHeight = 75.0,
            maxHeight = 87.0,
            ageRange = "2-3å²",
            minAgeMonths = 24,
            maxAgeMonths = 36,
            dummyType = CrashTestDummy.Q1_5,
            installDirection = InstallDirection.REARWARD,
            standardRequirement = "åå‘å®‰è£…å¼ºåˆ¶è¦æ±‚ã€HICâ‰¤750"
        ),
        HeightIntervalConfig(
            minHeight = 87.0,
            maxHeight = 105.0,
            ageRange = "3-4å²",
            minAgeMonths = 36,
            maxAgeMonths = 48,
            dummyType = CrashTestDummy.Q3,
            installDirection = InstallDirection.REARWARD,
            standardRequirement = "åå‘å®‰è£…å¼ºåˆ¶è¦æ±‚ã€HICâ‰¤750"
        ),
        HeightIntervalConfig(
            minHeight = 105.0,
            maxHeight = 125.0,
            ageRange = "4-6å²",
            minAgeMonths = 48,
            maxAgeMonths = 72,
            dummyType = CrashTestDummy.Q6,
            installDirection = InstallDirection.FORWARD,
            standardRequirement = "å‰å‘å®‰è£…ã€ISOFIX+ä¸Šæ‹‰å¸¦é˜²æ—‹è½¬ã€HICâ‰¤1000"
        ),
        HeightIntervalConfig(
            minHeight = 125.0,
            maxHeight = 150.0,
            ageRange = "6-12å²",
            minAgeMonths = 72,
            maxAgeMonths = 144,
            dummyType = CrashTestDummy.Q10,
            installDirection = InstallDirection.FORWARD,
            standardRequirement = "å‰å‘å®‰è£…ã€ISOFIX+ä¸Šæ‹‰å¸¦é˜²æ—‹è½¬ã€HICâ‰¤1000"
        )
    )

    /**
     * å…¨å¹´é¾„æ®µé…ç½®ï¼ˆ40-150cmï¼‰
     */
    val FULL_AGE_RANGE = AgeRangeInfo(
        ageRange = "0-12å²",
        minAgeMonths = 0,
        maxAgeMonths = 144,
        dummyRange = "Q0-Q10",
        description = "è¦†ç›–0-12å²å…¨å¹´é¾„æ®µï¼Œé€‚é…Q0-Q10 dummy"
    )

    /**
     * å¹´é¾„æ®µä¿¡æ¯
     */
    data class AgeRangeInfo(
        val ageRange: String,        // å¹´é¾„æ®µæè¿°
        val minAgeMonths: Int,       // æœ€å°å¹´é¾„ï¼ˆæœˆï¼‰
        val maxAgeMonths: Int,       // æœ€å¤§å¹´é¾„ï¼ˆæœˆï¼‰
        val dummyRange: String,      // DummyèŒƒå›´
        val description: String      // è¯¦ç»†æè¿°
    )

    /**
     * æ ¹æ®èº«é«˜èŒƒå›´è·å–å¯¹åº”çš„å¹´é¾„æ®µä¿¡æ¯
     */
    fun getAgeRangeInfo(minHeight: Double, maxHeight: Double): AgeRangeInfo {
        // å¼ºåˆ¶è§„åˆ™ï¼š40-150cm â†’ 0-12å²
        return if (minHeight >= 40.0 && maxHeight <= 150.0) {
            FULL_AGE_RANGE
        } else {
            val intervals = getIntervalsByHeightRange(minHeight, maxHeight)
            if (intervals.isNotEmpty()) {
                val minAge = intervals.minOf { it.minAgeMonths }
                val maxAge = intervals.maxOf { it.maxAgeMonths }
                val dummyTypes = intervals.map { it.dummyType.name }.distinct().joinToString("-")
                AgeRangeInfo(
                    ageRange = "${minAge / 12}-${maxAge / 12}å²",
                    minAgeMonths = minAge,
                    maxAgeMonths = maxAge,
                    dummyRange = dummyTypes,
                    description = "è¦†ç›–${minAge / 12}-${maxAge / 12}å²ï¼Œé€‚é…$dummyTypes dummy"
                )
            } else {
                FULL_AGE_RANGE
            }
        }
    }

    /**
     * è·å–ä¿®æ­£æç¤ºä¿¡æ¯
     */
    fun getCorrectionHint(): String {
        return "æ£€æµ‹åˆ°èº«é«˜ä¸å¹´é¾„æ®µä¸åŒ¹é…ï¼Œå·²å°†å¹´é¾„æ®µä¿®æ­£ä¸º0-12å²"
    }

    /**
     * è·å–æ ‡å‡†åˆè§„æ€§è¯´æ˜
     */
    fun getStandardComplianceText(): String {
        return """
            ç¬¦åˆUN R129 i-Sizeå„¿ç«¥æ ‡å‡†ï¼Œè¦†ç›–Q0-Q10 dummyï¼Œæ»¡è¶³å…¨å¹´é¾„æ®µå®‰å…¨è¦æ±‚ã€‚
            
            åŠŸèƒ½é€‚é…ï¼š
            â€¢ æ”¯æŒå¤šæ¡£ä½è‚©å¸¦é«˜åº¦è°ƒèŠ‚ï¼ˆé€‚é…Q0-Q10è‚©é«˜èŒƒå›´ï¼‰
            â€¢ å¯æ‹†å¸å¤´æ•ï¼ˆé€‚é…ä¸åŒèº«é«˜å„¿ç«¥ï¼‰
            â€¢ 360Â°æ—‹è½¬åŠŸèƒ½ï¼ˆä¾¿äºä¸Šä¸‹è½¦ï¼‰
            â€¢ ä¾§æ’é˜²æŠ¤ç³»ç»Ÿï¼ˆæ»¡è¶³ECE R129ä¾§æ’è¦æ±‚ï¼‰
            â€¢ ISOFIX+ä¸Šæ‹‰å¸¦å›ºå®šç³»ç»Ÿï¼ˆå®‰è£…ä¾¿æ·æ€§ï¼‰
        """.trimIndent()
    }
}
```

---

## ğŸ› ï¸ å·¥å…·ç±»å±‚

### 1. æ–¹æ¡ˆä¼˜åŒ–å·¥å…· (SchemeOptimizer.kt)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/childproduct/designassistant/helper/SchemeOptimizer.kt`

```kotlin
package com.childproduct.designassistant.helper

import com.childproduct.designassistant.model.ChildProductDesignScheme
import com.childproduct.designassistant.model.InstallMethod
import com.childproduct.designassistant.model.TestMatrixItem
import java.nio.charset.StandardCharsets

/**
 * æ ¸å¿ƒå·¥å…·ç±»ï¼šæ•´åˆä¹±ç æ¸…ç†ã€åŠ¨æ€æ–¹æ¡ˆç”Ÿæˆã€æ ‡å‡†å‚æ•°æ˜ å°„
 */
object SchemeOptimizer {
    // 1. æ ‡å‡†æ˜ å°„è¡¨ï¼šèº«é«˜èŒƒå›´ â†’ (é€‚ç”¨å¹´é¾„æ®µ, é€‚é…å‡äººæè¿°)
    private val HEIGHT_AGE_DUMMY_MAP = mapOf(
        "40-60cm" to Pair("0-1å²", "Q0å‡äºº"),
        "60-75cm" to Pair("1-2å²", "Q1å‡äºº"),
        "75-87cm" to Pair("2-3å²", "Q1.5å‡äºº"),
        "87-105cm" to Pair("3-4å²", "Q3å‡äºº"),
        "105-125cm" to Pair("4-6å²", "Q6å‡äºº"),
        "125-150cm" to Pair("6-12å²", "Q10å‡äºº"),
        "40-150cm" to Pair("0-12å²", "Q0-Q10å…¨å‡äºº")
    )

    /**
     * ç”¨æˆ·è¾“å…¥æ•°æ®æ¨¡å‹
     */
    data class UserInput(
        val productType: String,
        val heightRange: String,
        val installMethod: InstallMethod,
        val themeKeyword: String
    )

    /**
     * å…¥å£æ–¹æ³•ï¼šæ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œç”Ÿæˆä¼˜åŒ–åçš„è®¾è®¡æ–¹æ¡ˆ
     */
    fun generateOptimizedScheme(userInput: UserInput): ChildProductDesignScheme {
        // æ­¥éª¤1ï¼šæ¸…ç†è®¾è®¡ä¸»é¢˜å…³é”®è¯ä¸­çš„ä¹±ç 
        val cleanedThemeKeyword = cleanGarbledContent(userInput.themeKeyword)

        // æ­¥éª¤2ï¼šåŠ¨æ€ç”ŸæˆåŸºç¡€ä¿¡æ¯
        val (ageRange, dummyType) = HEIGHT_AGE_DUMMY_MAP[userInput.heightRange]
            ?: HEIGHT_AGE_DUMMY_MAP["40-150cm"]!! // å…œåº•é»˜è®¤å€¼
        val designTheme = "${userInput.productType} - $cleanedThemeKeyword"

        // æ­¥éª¤3ï¼šåŠ¨æ€ç”Ÿæˆæ ¸å¿ƒè®¾è®¡ç‰¹ç‚¹ï¼ˆè”åŠ¨å®‰è£…æ–¹å¼ï¼‰
        val coreFeatures = generateCoreFeatures(userInput.installMethod)

        // æ­¥éª¤4ï¼šç”Ÿæˆæ¨èææ–™ï¼ˆå«æ ‡å‡†æ€§èƒ½å‚æ•°ï¼‰
        val recommendMaterials = generateRecommendMaterials()

        // æ­¥éª¤5ï¼šç”Ÿæˆç»“æ„åŒ–æµ‹è¯•çŸ©é˜µï¼ˆå‚ç…§ROADMATE 360ï¼‰
        val testMatrix = generateTestMatrix()

        // æ­¥éª¤6ï¼šç”Ÿæˆåˆè§„æ ‡å‡†
        val complianceStandards = listOf("ECE R129", "GB 27887-2024", "FMVSS 213")

        // æ­¥éª¤7ï¼šç”Ÿæˆå®‰å…¨é˜ˆå€¼
        val safetyThresholds = mapOf(
            "HICæé™å€¼" to "â‰¤390ï¼ˆQ0-Q1.5ï¼‰/â‰¤1000ï¼ˆQ3-Q10ï¼‰",
            "èƒ¸éƒ¨åŠ é€Ÿåº¦" to "â‰¤55gï¼ˆQ0-Q1.5ï¼‰/â‰¤60gï¼ˆQ3-Q10ï¼‰",
            "é¢ˆéƒ¨å¼ åŠ›æé™" to "â‰¤1800Nï¼ˆQ3-Q10ï¼‰",
            "å¤´éƒ¨ä½ç§»æé™" to "â‰¤550mmï¼ˆå…¨å‡äººï¼‰",
            "é˜»ç‡ƒæ€§èƒ½" to "ç¬¦åˆFMVSS 302ï¼ˆç‡ƒçƒ§é€Ÿåº¦â‰¤4è‹±å¯¸/åˆ†é’Ÿï¼‰"
        )

        // æ­¥éª¤8ï¼šç”Ÿæˆå®‰å…¨æ³¨æ„äº‹é¡¹ï¼ˆå…³è”ISO/ECEæ ‡å‡†ï¼‰
        val safetyNotes = generateSafetyNotes()

        // ç»„è£…æœ€ç»ˆæ–¹æ¡ˆ
        return ChildProductDesignScheme(
            productType = userInput.productType,
            heightRange = userInput.heightRange,
            ageRange = ageRange,
            designTheme = designTheme,
            installMethodDesc = userInput.installMethod.description,
            coreFeatures = coreFeatures,
            recommendMaterials = recommendMaterials,
            complianceStandards = complianceStandards,
            dummyType = dummyType,
            safetyThresholds = safetyThresholds,
            testMatrix = testMatrix,
            safetyNotes = safetyNotes
        )
    }

    /**
     * å…¨ç»´åº¦ä¹±ç æ¸…ç†
     */
    private fun cleanGarbledContent(rawContent: String): String {
        var cleaned = rawContent
        // 1. å¼ºåˆ¶ç»Ÿä¸€UTF-8ç¼–ç 
        cleaned = String(cleaned.toByteArray(StandardCharsets.UTF_8), StandardCharsets.UTF_8)

        // 2. ç§»é™¤ä»£ç å¼å­—æ®µ
        val codePatterns = listOf(
            Regex("""CreativeIdea\(id=.+?\)"""),
            Regex("""[a-zA-Z_]+=[\w#\[\],]+"""),
            Regex("""[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}""") // UUID
        )
        codePatterns.forEach { cleaned = it.replace(cleaned, "") }

        // 3. è¿‡æ»¤ç‰¹æ®Šå­—ç¬¦
        val specialPatterns = listOf(
            Regex("""\\u[0-9a-fA-F]{4}"""), // Unicodeè½¬ä¹‰ç¬¦
            Regex("""[\p{So}\p{Sk}]"""),    // Emoji/ç‰¹æ®Šç¬¦å·
            Regex("""[\t\r\f\v]"""),       // ä¸å¯è§æ§åˆ¶å­—ç¬¦
            Regex("""\s{2,}""")            // å¤šä½™ç©ºæ ¼
        )
        specialPatterns.forEach {
            cleaned = if (it.pattern == """\s{2,}""") it.replace(cleaned, " ") else it.replace(cleaned, "")
        }

        return cleaned.trim()
    }

    /**
     * åŠ¨æ€ç”Ÿæˆæ ¸å¿ƒè®¾è®¡ç‰¹ç‚¹ï¼ˆè”åŠ¨ç”¨æˆ·é€‰æ‹©çš„å®‰è£…æ–¹å¼ï¼‰
     */
    private fun generateCoreFeatures(installMethod: InstallMethod): List<String> {
        return listOf(
            "æ˜“å®‰è£…æ€§ï¼š${installMethod.description}",
            "å®‰å…¨æ€§ï¼šç¬¦åˆECE R129/GB 27887-2024 + FMVSS 213æ ‡å‡†ï¼ˆå…¨å‡äººè¦†ç›–ï¼‰",
            "èˆ’é€‚æ€§ï¼šé«˜å›å¼¹æµ·ç»µå¡«å……ï¼ˆå¯†åº¦30kg/mÂ³ï¼Œé€‚é…0-12å²å„¿ç«¥ä½“å‹ï¼‰",
            "æè´¨ç¯ä¿ï¼šé£Ÿå“çº§PPå¡‘æ–™ï¼ˆæ— ç”²é†›/é‡é‡‘å±ï¼Œç¬¦åˆEN 71-3æœ‰å®³å…ƒç´ æ ‡å‡†ï¼‰"
        )
    }

    /**
     * ç”Ÿæˆæ¨èææ–™ï¼ˆå«ECE R129è¦æ±‚çš„æ€§èƒ½å‚æ•°ï¼‰
     */
    private fun generateRecommendMaterials(): List<String> {
        return listOf(
            "ä¸»ä½“æ¡†æ¶ï¼šé£Ÿå“çº§PPå¡‘æ–™ï¼ˆè€æ¸©-30â„ƒ~80â„ƒï¼ŒæŠ—å†²å‡»å¼ºåº¦â‰¥20kJ/mÂ²ï¼‰",
            "å¡«å……å±‚ï¼šé«˜å›å¼¹æµ·ç»µï¼ˆå‹ç¼©å›å¼¹ç‡â‰¥90%ï¼Œæ— å¼‚å‘³ï¼‰",
            "çº¦æŸéƒ¨ä»¶ï¼šé«˜å¼ºåº¦å®‰å…¨å¸¦ç»‡å¸¦ï¼ˆæ–­è£‚å¼ºåº¦â‰¥11000Nï¼Œè€ç£¨åå¼ºåº¦ä¿ç•™ç‡â‰¥75%ï¼‰",
            "æ”¯æ’‘ç»“æ„ï¼šé“åˆé‡‘æ”¯æ¶ï¼ˆç›é›¾æµ‹è¯•50å°æ—¶æ— è…èš€ï¼ŒæŠ—æ‹‰å¼ºåº¦â‰¥300MPaï¼‰",
            "é¢æ–™ï¼šé˜»ç‡ƒèšé…¯çº¤ç»´ï¼ˆç¬¦åˆFMVSS 302ï¼Œç‡ƒçƒ§é€Ÿåº¦â‰¤4è‹±å¯¸/åˆ†é’Ÿï¼‰"
        )
    }

    /**
     * ç”Ÿæˆç»“æ„åŒ–æµ‹è¯•çŸ©é˜µï¼ˆå‚ç…§ROADMATE 360æ ¼å¼ï¼Œå…³è”æ ‡å‡†æ¡æ¬¾ï¼‰
     */
    private fun generateTestMatrix(): List<TestMatrixItem> {
        return listOf(
            TestMatrixItem(
                testItem = "HICæé™å€¼",
                standardRequirement = "â‰¤390ï¼ˆQ0-Q1.5ï¼‰/ â‰¤1000ï¼ˆQ3-Q10ï¼‰",
                applicableDummy = "Q0-Q10",
                unit = "-",
                standardSource = "ECE R129 Â§7.1.2"
            ),
            TestMatrixItem(
                testItem = "èƒ¸éƒ¨åŠ é€Ÿåº¦ï¼ˆ3msï¼‰",
                standardRequirement = "â‰¤55gï¼ˆQ0-Q1.5ï¼‰/ â‰¤60gï¼ˆQ3-Q10ï¼‰",
                applicableDummy = "Q0-Q10",
                unit = "g",
                standardSource = "ECE R129 Â§7.1.3"
            ),
            TestMatrixItem(
                testItem = "é¢ˆéƒ¨å¼ åŠ›æé™",
                standardRequirement = "â‰¤1500Nï¼ˆQ0-Q1.5ï¼‰/ â‰¤1800Nï¼ˆQ3-Q10ï¼‰",
                applicableDummy = "Q0-Q10",
                unit = "N",
                standardSource = "ECE R129 Â§7.1.4"
            ),
            TestMatrixItem(
                testItem = "é¢ˆéƒ¨å‹ç¼©æé™",
                standardRequirement = "â‰¤2000Nï¼ˆQ0-Q1.5ï¼‰/ â‰¤2500Nï¼ˆQ3-Q10ï¼‰",
                applicableDummy = "Q0-Q10",
                unit = "N",
                standardSource = "ECE R129 Â§7.1.4"
            ),
            TestMatrixItem(
                testItem = "å¤´éƒ¨ä½ç§»æé™",
                standardRequirement = "â‰¤550mmï¼ˆå…¨å‡äººï¼‰",
                applicableDummy = "Q0-Q10",
                unit = "mm",
                standardSource = "ECE R129 Â§7.1.5"
            ),
            TestMatrixItem(
                testItem = "è†éƒ¨ä½ç§»æé™",
                standardRequirement = "â‰¤650mmï¼ˆå…¨å‡äººï¼‰",
                applicableDummy = "Q0-Q10",
                unit = "mm",
                standardSource = "ECE R129 Â§7.1.5"
            ),
            TestMatrixItem(
                testItem = "èƒ¸éƒ¨å‹ç¼©æé™",
                standardRequirement = "â‰¤45mmï¼ˆQ0-Q1.5ï¼‰/ â‰¤52mmï¼ˆQ3-Q10ï¼‰",
                applicableDummy = "Q0-Q10",
                unit = "mm",
                standardSource = "ECE R129 Â§7.1.6"
            ),
            TestMatrixItem(
                testItem = "é˜»ç‡ƒæ€§èƒ½",
                standardRequirement = "ç‡ƒçƒ§é€Ÿåº¦â‰¤4è‹±å¯¸/åˆ†é’Ÿ",
                applicableDummy = "å…¨å¹´é¾„æ®µ",
                unit = "-",
                standardSource = "FMVSS 302"
            )
        )
    }

    /**
     * ç”Ÿæˆå®‰å…¨æ³¨æ„äº‹é¡¹ï¼ˆå…³è”ISO 8124-3/ECE R129æ ‡å‡†ï¼‰
     */
    private fun generateSafetyNotes(): List<String> {
        return listOf(
            "é˜²åå’½é£é™©ï¼šæ‰€æœ‰å¯æ‹†å¸éƒ¨ä»¶å°ºå¯¸â‰¥3.5cmï¼ˆISO 8124-2è¦æ±‚ï¼‰",
            "æè´¨å®‰å…¨ï¼šä½¿ç”¨é£Ÿå“çº§PPå¡‘æ–™ï¼Œæ— ç”²é†›/é‡é‡‘å±æ®‹ç•™ï¼ˆGB 6675.4/EN 71-3ï¼‰",
            "è¾¹ç¼˜å®‰å…¨ï¼šäº§å“è¾¹ç¼˜åšåœ†è§’å¤„ç†ï¼ˆRâ‰¥2mmï¼‰ï¼Œæ— å°–é”çªå‡ºç‰©ï¼ˆISO 8124-1ï¼‰",
            "é˜²ç«é˜»ç‡ƒï¼šé¢æ–™é€šè¿‡FMVSS 302è®¤è¯ï¼ˆç‡ƒçƒ§é€Ÿåº¦â‰¤4è‹±å¯¸/åˆ†é’Ÿï¼‰",
            "å®‰è£…è­¦ç¤ºï¼šå¿…é¡»ä¸¥æ ¼æŒ‰ç…§ISOFIX/å®‰å…¨å¸¦å›ºå®šè¯´æ˜å®‰è£…ï¼ˆECE R129 Â§5.2ï¼‰"
        )
    }

    /**
     * æ ¼å¼åŒ–æ–¹æ¡ˆç”¨äºUIå±•ç¤º
     */
    fun formatSchemeForDisplay(scheme: ChildProductDesignScheme): String {
        return buildString {
            appendLine("ã€è®¾è®¡æ–¹æ¡ˆã€‘")
            appendLine("äº§å“ç±»å‹ï¼š${scheme.productType}")
            appendLine("èº«é«˜èŒƒå›´ï¼š${scheme.heightRange}")
            appendLine("å¹´é¾„æ®µï¼š${scheme.ageRange}")
            appendLine("è®¾è®¡ä¸»é¢˜ï¼š${scheme.designTheme}")
            appendLine()
            appendLine("ã€å®‰è£…æ–¹å¼ã€‘")
            appendLine(scheme.installMethodDesc)
            appendLine()
            appendLine("ã€æ ¸å¿ƒç‰¹ç‚¹ã€‘")
            scheme.coreFeatures.forEach { appendLine("- $it") }
            appendLine()
            appendLine("ã€æ¨èææ–™ã€‘")
            scheme.recommendMaterials.forEach { appendLine("- $it") }
            appendLine()
            appendLine("ã€åˆè§„æ ‡å‡†ã€‘")
            scheme.complianceStandards.forEach { appendLine("- $it") }
            appendLine()
            appendLine("ã€é€‚é…å‡äººã€‘")
            appendLine(scheme.dummyType)
            appendLine()
            appendLine("ã€å®‰å…¨é˜ˆå€¼ã€‘")
            scheme.safetyThresholds.forEach { (key, value) ->
                appendLine("- $keyï¼š$value")
            }
            appendLine()
            appendLine("ã€å®‰å…¨æ³¨æ„äº‹é¡¹ã€‘")
            scheme.safetyNotes.forEach { appendLine("- $it") }
        }
    }
}
```

---

### 2. UIè¾…åŠ©ç±» (UiHelper.kt)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/childproduct/designassistant/helper/UiHelper.kt`

```kotlin
package com.childproduct.designassistant.helper

import android.content.Context
import android.widget.RadioButton
import android.widget.RadioGroup
import com.childproduct.designassistant.model.InstallMethod

/**
 * UIäº¤äº’è¾…åŠ©ç±»ï¼šå¸®åŠ©å¿«é€Ÿå®ç°è¾“å…¥é¡¹çš„UIé€‚é…ï¼ˆå¦‚å®‰è£…æ–¹å¼å•é€‰æŒ‰é’®ï¼‰
 */
object UiHelper {
    /**
     * ä¸ºå®‰è£…æ–¹å¼å•é€‰ç»„è®¾ç½®é€‰é¡¹ï¼ˆåŠ¨æ€ç”Ÿæˆå•é€‰æŒ‰é’®ï¼Œæ— éœ€XMLç¡¬ç¼–ç ï¼‰
     * @param context  ä¸Šä¸‹æ–‡
     * @param radioGroup  ç›®æ ‡å•é€‰ç»„
     * @param onSelect  é€‰æ‹©å›è°ƒï¼ˆè¿”å›ç”¨æˆ·é€‰ä¸­çš„InstallMethodï¼‰
     */
    fun setupInstallMethodRadioGroup(
        context: Context,
        radioGroup: RadioGroup,
        onSelect: (InstallMethod) -> Unit
    ) {
        // æ¸…ç©ºåŸæœ‰é€‰é¡¹
        radioGroup.removeAllViews()

        // éå†InstallMethodæšä¸¾ï¼Œç”Ÿæˆå•é€‰æŒ‰é’®
        InstallMethod.values().forEachIndexed { index, method ->
            val radioButton = RadioButton(context).apply {
                text = method.displayName // æ˜¾ç¤ºåç§°ï¼ˆå¦‚ï¼šISOFIX + Top-tetherï¼‰
                tag = method // ç»‘å®šæšä¸¾å€¼ï¼Œä¾¿äºåç»­è·å–
                // è®¾ç½®é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªé€‰é¡¹
                isChecked = index == 0
            }
            radioGroup.addView(radioButton)
        }

        // è®¾ç½®é€‰æ‹©ç›‘å¬
        radioGroup.setOnCheckedChangeListener { _, checkedId ->
            val selectedRadio = radioGroup.findViewById<RadioButton>(checkedId)
            val selectedMethod = selectedRadio.tag as InstallMethod
            onSelect(selectedMethod)
        }
    }

    /**
     * éªŒè¯ç”¨æˆ·è¾“å…¥æ˜¯å¦åˆæ³•ï¼ˆå¦‚èº«é«˜èŒƒå›´æ ¼å¼ï¼‰
     * @param userInput  ç”¨æˆ·è¾“å…¥
     * @return  åˆæ³•è¿”å›nullï¼Œä¸åˆæ³•è¿”å›é”™è¯¯æç¤º
     */
    fun validateUserInput(userInput: SchemeOptimizer.UserInput): String? {
        // 1. éªŒè¯äº§å“ç±»å‹éç©º
        if (userInput.productType.isBlank()) {
            return "è¯·é€‰æ‹©äº§å“ç±»å‹ï¼ˆå¦‚ï¼šå„¿ç«¥å®‰å…¨åº§æ¤…ï¼‰"
        }

        // 2. éªŒè¯èº«é«˜èŒƒå›´æ ¼å¼ï¼ˆå¦‚ï¼š40-150cmï¼‰
        val heightPattern = Regex("""^\d{2,3}-\d{2,3}cm$""")
        if (!heightPattern.matches(userInput.heightRange)) {
            return "èº«é«˜èŒƒå›´æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥å¦‚ï¼š40-150cm"
        }

        // 3. éªŒè¯è®¾è®¡ä¸»é¢˜å…³é”®è¯éç©º
        if (userInput.themeKeyword.isBlank()) {
            return "è¯·è¾“å…¥è®¾è®¡ä¸»é¢˜å…³é”®è¯ï¼ˆå¦‚ï¼šæ‹¼å›¾æ¸¸æˆã€å¡é€šå›¾æ¡ˆï¼‰"
        }

        // è¾“å…¥åˆæ³•
        return null
    }
}
```

---

### 3. è¾“å‡ºåˆè§„æ£€æŸ¥å™¨ (OutputComplianceChecker.kt)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/childproduct/designassistant/utils/OutputComplianceChecker.kt`

```kotlin
package com.childproduct.designassistant.utils

import com.childproduct.designassistant.model.ChildProductDesignScheme

/**
 * æ ¸å¿ƒä¼˜åŒ–å·¥å…·ç±»ï¼šæ¸…ç†ä¹±ç +ä¿®æ­£å‚æ•°+ç»“æ„åŒ–è¾“å‡º
 *
 * è§£å†³çš„é—®é¢˜ï¼š
 * 1. å‚æ•°åŒ¹é…é”™è¯¯ï¼ˆè¿åUN R129/GB 27887-2024æ ‡å‡†ï¼‰
 * 2. è¾“å‡ºå†…å®¹å«å¤§é‡ä¹±ç /å†—ä½™ä»£ç å­—æ®µ
 * 3. ä¿¡æ¯é‡å¤å †ç Œ
 * 4. ç•Œé¢ä¿¡æ¯è‡ªç›¸çŸ›ç›¾
 * 5. è¾“å‡ºæ’ç‰ˆæ— ç»“æ„åŒ–
 */
object OutputComplianceChecker {

    // ========== æ ‡å‡†æ˜ å°„è¡¨ ==========

    /**
     * æ ‡å‡†æ˜ å°„è¡¨ï¼šèº«é«˜â†’(æ­£ç¡®å¹´é¾„æ®µ, æ­£ç¡®å‡äººç±»å‹)
     * ç¬¦åˆ UN R129 / GB 27887-2024 æ ‡å‡†
     */
    private val STANDARD_MAPPING = mapOf(
        "40-150" to Pair("0-12å²", "Q0-Q10ï¼ˆå…¨å¹´é¾„æ®µå‡äººï¼‰"),
        "40-150cm" to Pair("0-12å²", "Q0-Q10ï¼ˆå…¨å¹´é¾„æ®µå‡äººï¼‰"),
        "87-105" to Pair("3-4å²", "Q3å‡äºº"),
        "87-105cm" to Pair("3-4å²", "Q3å‡äºº"),
        "125-150" to Pair("6-12å²", "Q10å‡äºº"),
        "125-150cm" to Pair("6-12å²", "Q10å‡äºº"),
        "40-60" to Pair("0-1å²", "Q0å‡äºº"),
        "40-60cm" to Pair("0-1å²", "Q0å‡äºº"),
        "60-75" to Pair("1-2å²", "Q1å‡äºº"),
        "60-75cm" to Pair("1-2å²", "Q1å‡äºº"),
        "75-87" to Pair("2-3å²", "Q1.5å‡äºº"),
        "75-87cm" to Pair("2-3å²", "Q1.5å‡äºº"),
        "105-125" to Pair("4-6å²", "Q6å‡äºº"),
        "105-125cm" to Pair("4-6å²", "Q6å‡äºº")
    )

    /**
     * å›ºå®šå®‰å…¨é˜ˆå€¼ï¼ˆæŒ‰æ ‡å‡†å®šä¹‰ï¼Œæ— é‡å¤ï¼‰
     */
    private val STANDARD_SAFETY_THRESHOLDS = mapOf(
        "HICæé™å€¼" to "â‰¤390ï¼ˆQ0-Q1.5ï¼‰/â‰¤1000ï¼ˆQ3-Q10ï¼‰",
        "èƒ¸éƒ¨åŠ é€Ÿåº¦" to "â‰¤55gï¼ˆQ0-Q1.5ï¼‰/â‰¤60gï¼ˆQ3-Q10ï¼‰",
        "é¢ˆéƒ¨å¼ åŠ›æé™" to "â‰¤1800Nï¼ˆQ3-Q10ï¼‰",
        "å¤´éƒ¨ä½ç§»æé™" to "â‰¤550mmï¼ˆå…¨å‡äººï¼‰",
        "é˜»ç‡ƒæ€§èƒ½" to "ç¬¦åˆFMVSS 302ï¼ˆç‡ƒçƒ§é€Ÿåº¦â‰¤4è‹±å¯¸/åˆ†é’Ÿï¼‰"
    )

    /**
     * æ ‡å‡†åˆè§„æ ‡å‡†ï¼ˆå»é‡åï¼‰
     */
    private val STANDARD_COMPLIANCE_STANDARDS = listOf(
        "ECE R129 / GB 27887-2024",
        "FMVSS 213ï¼ˆç¾æ ‡ï¼‰"
    )

    // ========== æ ¸å¿ƒæ–¹æ³• ==========

    /**
     * æ ¸å¿ƒå…¥å£ï¼šè¾“å…¥åŸå§‹æ‚ä¹±å†…å®¹ï¼Œè¾“å‡ºæ ‡å‡†åŒ–ç»“æ„åŒ–æ–¹æ¡ˆ
     */
    fun optimizeScheme(
        rawContent: String,
        inputHeight: String,
        productType: String = "å„¿ç«¥å®‰å…¨åº§æ¤…"
    ): String {
        val cleanedContent = cleanRawContent(rawContent)  // æ­¥éª¤1ï¼šæ¸…ç†ä¹±ç /å†—ä½™
        val standardScheme = parseToStandardScheme(
            cleanedContent,
            inputHeight,
            productType
        )  // æ­¥éª¤2ï¼šä¿®æ­£å‚æ•°
        return generateStructuredOutput(standardScheme)  // æ­¥éª¤3ï¼šç»“æ„åŒ–è¾“å‡º
    }

    /**
     * å…¼å®¹æ—§æ¥å£çš„æ–¹æ³•ï¼ˆå‘åå…¼å®¹ï¼‰
     */
    fun checkAndFixOutput(
        rawOutput: String,
        inputHeightRange: String = "40-150",
        productType: String = "å„¿ç«¥å®‰å…¨åº§æ¤…"
    ): String {
        return optimizeScheme(rawOutput, inputHeightRange, productType)
    }

    // ========== ç§æœ‰æ–¹æ³• ==========

    /**
     * æ­¥éª¤1ï¼šæ¸…ç†åŸå§‹å†…å®¹ï¼ˆå»ä¹±ç ã€å»ä»£ç å­—æ®µã€å»é‡å¤ï¼‰
     */
    private fun cleanRawContent(rawContent: String): String {
        var cleaned = rawContent

        // 1. ç§»é™¤æ‰€æœ‰ä»£ç å¼å­—æ®µ
        val codePattern = Regex(
            """CreativeIdea\(id=.+?\)|productType=\w+|ageGroup=\w+|""" +
                    """complianceParameters=.+?\)|standardsReference=.+?\)|""" +
                    """materialSpecs=.+?\)|colorPalette=.+?\)|\w+=[\w#]+"""
        )
        cleaned = codePattern.replace(cleaned, "")

        // 2. è¿‡æ»¤ä¹±ç å­—ç¬¦
        val garbledPattern = Regex(
            """[^\\u4e00-\\u9fa50-9a-zA-Z\\s\\-\\+\\â‰¤â‰¥ï¼ˆï¼‰ã€ã€‘ï¼šï¼›,.ï¼Œã€‚ï¼ï¼Ÿcm/()%]"""
        )
        cleaned = garbledPattern.replace(cleaned, "")

        // 3. æŒ‰è¡Œå»é‡ï¼Œç§»é™¤ç©ºè¡Œ
        val lines = cleaned.split("\n")
            .map { it.trim() }
            .filter { it.isNotEmpty() }

        return lines.distinct().joinToString(" ")
    }

    /**
     * æ­¥éª¤2ï¼šè§£æä¸ºæ ‡å‡†åŒ–æ¨¡å‹ï¼ˆä¿®æ­£èº«é«˜-å¹´é¾„æ®µ-å‡äººåŒ¹é…é”™è¯¯ï¼‰
     */
    private fun parseToStandardScheme(
        cleanedContent: String,
        inputHeight: String,
        productType: String
    ): ChildProductDesignScheme {
        // æå–æ ¸å¿ƒä¿¡æ¯ï¼ˆå…¼å®¹æ¨¡ç³ŠåŒ¹é…ï¼‰
        val designTheme = extractDesignTheme(cleanedContent)

        // æ ¸å¿ƒç‰¹ç‚¹ï¼ˆå»é‡ï¼‰
        val coreFeatures = extractCoreFeatures(cleanedContent).distinct()

        // æ¨èææ–™ï¼ˆå»é‡ï¼‰
        val recommendMaterials = extractRecommendMaterials(cleanedContent).distinct()

        // åˆè§„æ ‡å‡†ï¼ˆå»é‡ï¼‰
        val complianceStandards = extractComplianceStandards(cleanedContent).distinct()

        // å®‰å…¨æç¤ºï¼ˆå»é‡ï¼‰
        val safetyNotes = extractSafetyNotes(cleanedContent).distinct()

        // å¼ºåˆ¶ä¿®æ­£èº«é«˜å¯¹åº”çš„å¹´é¾„æ®µå’Œå‡äººï¼ˆè§£å†³æ ¸å¿ƒåŒ¹é…é”™è¯¯ï¼‰
        val (correctAge, correctDummy) = STANDARD_MAPPING[inputHeight]
            ?: STANDARD_MAPPING["40-150cm"]!!

        return ChildProductDesignScheme(
            productType = productType,
            heightRange = inputHeight,
            ageRange = correctAge,
            designTheme = designTheme,
            installMethodDesc = "ISOFIXå¿«é€Ÿè¿æ¥ï¼ˆå…¼å®¹å¤šç§å®‰è£…æ–¹å¼ï¼‰",
            coreFeatures = coreFeatures,
            recommendMaterials = recommendMaterials,
            complianceStandards = complianceStandards,
            dummyType = correctDummy,
            safetyThresholds = STANDARD_SAFETY_THRESHOLDS,
            testMatrix = emptyList(),  // æ—§ç‰ˆæœ¬å…¼å®¹ï¼Œå®é™…ä½¿ç”¨ SchemeOptimizer
            safetyNotes = safetyNotes
        )
    }

    /**
     * æå–è®¾è®¡ä¸»é¢˜
     */
    private fun extractDesignTheme(content: String): String {
        val themePattern = Regex("è®¾è®¡ä¸»é¢˜[:ï¼š](.+?)|åˆ›æ„ä¸»é¢˜[:ï¼š](.+?)|theme[:ï¼š](.+?)")
        return themePattern.find(content)?.groupValues?.let {
            it[1].ifEmpty { it[2].ifEmpty { it[3] } }
        } ?: "åˆ›æ„å„¿ç«¥å®‰å…¨åº§æ¤…"
    }

    /**
     * æå–æ ¸å¿ƒç‰¹ç‚¹
     */
    private fun extractCoreFeatures(content: String): List<String> {
        val features = mutableListOf<String>()

        if (content.contains("æ˜“å®‰è£…æ€§")) {
            features.add("æ˜“å®‰è£…æ€§ï¼ˆISOFIXå¿«é€Ÿè¿æ¥ï¼‰")
        }
        if (content.contains("å®‰å…¨æ€§")) {
            features.add("å®‰å…¨æ€§ï¼ˆç¬¦åˆECE R129/GB 27887-2024æ ‡å‡†ï¼‰")
        }
        if (content.contains("èˆ’é€‚æ€§")) {
            features.add("èˆ’é€‚æ€§ï¼ˆé«˜å›å¼¹æµ·ç»µå¡«å……ï¼‰")
        }
        if (content.contains("æè´¨ç¯ä¿")) {
            features.add("æè´¨ç¯ä¿ï¼ˆé£Ÿå“çº§PPå¡‘æ–™ï¼‰")
        }

        return features
    }

    /**
     * æå–æ¨èææ–™
     */
    private fun extractRecommendMaterials(content: String): List<String> {
        val materials = mutableListOf<String>()

        if (content.contains("PPå¡‘æ–™")) {
            materials.add("é£Ÿå“çº§PPå¡‘æ–™")
        }
        if (content.contains("æµ·ç»µ") || content.contains("å¡«å……")) {
            materials.add("é«˜å›å¼¹æµ·ç»µå¡«å……")
        }
        if (content.contains("ç»‡å¸¦") || content.contains("å®‰å…¨å¸¦")) {
            materials.add("é«˜å¼ºåº¦å®‰å…¨å¸¦ç»‡å¸¦")
        }
        if (content.contains("é“åˆé‡‘") || content.contains("é‡‘å±")) {
            materials.add("é“åˆé‡‘æ”¯æ¶")
        }

        return materials
    }

    /**
     * æå–åˆè§„æ ‡å‡†
     */
    private fun extractComplianceStandards(content: String): List<String> {
        return STANDARD_COMPLIANCE_STANDARDS
    }

    /**
     * æå–å®‰å…¨æç¤º
     */
    private fun extractSafetyNotes(content: String): List<String> {
        val notes = mutableListOf<String>()

        if (content.contains("åå’½") || content.contains("å°ºå¯¸")) {
            notes.add("æ‰€æœ‰éƒ¨ä»¶å°ºå¯¸â‰¥3.5cmï¼Œé¿å…åå’½é£é™©")
        }
        if (content.contains("ç”²é†›") || content.contains("é‡é‡‘å±")) {
            notes.add("ä½¿ç”¨é£Ÿå“çº§å®‰å…¨ææ–™ï¼Œæ— ç”²é†›/é‡é‡‘å±æ®‹ç•™")
        }
        if (content.contains("è¾¹ç¼˜") || content.contains("åœ†è§’") || content.contains("å°–é”")) {
            notes.add("äº§å“è¾¹ç¼˜åšåœ†è§’å¤„ç†ï¼ˆRâ‰¥2mmï¼‰ï¼Œæ— å°–é”ç»“æ„")
        }

        return notes
    }

    /**
     * æ­¥éª¤3ï¼šç”Ÿæˆç»“æ„åŒ–è¾“å‡º
     */
    private fun generateStructuredOutput(scheme: ChildProductDesignScheme): String {
        return buildString {
            appendLine("ã€è®¾è®¡æ–¹æ¡ˆã€‘")
            appendLine("äº§å“ç±»å‹ï¼š${scheme.productType}")
            appendLine("èº«é«˜èŒƒå›´ï¼š${scheme.heightRange}")
            appendLine("å¹´é¾„æ®µï¼š${scheme.ageRange}")
            appendLine("è®¾è®¡ä¸»é¢˜ï¼š${scheme.designTheme}")
            appendLine()
            appendLine("ã€å®‰è£…æ–¹å¼ã€‘")
            appendLine(scheme.installMethodDesc)
            appendLine()
            appendLine("ã€æ ¸å¿ƒç‰¹ç‚¹ã€‘")
            scheme.coreFeatures.forEach { appendLine("- $it") }
            appendLine()
            appendLine("ã€æ¨èææ–™ã€‘")
            scheme.recommendMaterials.forEach { appendLine("- $it") }
            appendLine()
            appendLine("ã€åˆè§„æ ‡å‡†ã€‘")
            scheme.complianceStandards.forEach { appendLine("- $it") }
            appendLine()
            appendLine("ã€é€‚é…å‡äººã€‘")
            appendLine(scheme.dummyType)
            appendLine()
            appendLine("ã€å®‰å…¨é˜ˆå€¼ã€‘")
            scheme.safetyThresholds.forEach { (key, value) ->
                appendLine("- $keyï¼š$value")
            }
            appendLine()
            appendLine("ã€å®‰å…¨æ³¨æ„äº‹é¡¹ã€‘")
            scheme.safetyNotes.forEach { appendLine("- $it") }
        }
    }
}
```

---

### 4. è®¾è®¡æ–¹æ¡ˆæ ¼å¼åŒ–å™¨ (DesignSchemeFormatter.kt)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/childproduct/designassistant/utils/DesignSchemeFormatter.kt`

```kotlin
package com.childproduct.designassistant.utils

import com.childproduct.designassistant.model.*

/**
 * è®¾è®¡æ–¹æ¡ˆæ ¼å¼åŒ–å·¥å…·
 * å°†CreativeIdeaå¯¹è±¡è½¬æ¢ä¸ºç¬¦åˆè¾“å‡ºæ¨¡æ¿è§„èŒƒçš„ç»“æ„åŒ–æ–‡æœ¬æ ¼å¼
 */
object DesignSchemeFormatter {

    /**
     * æ ¼å¼åŒ–è®¾è®¡æ–¹æ¡ˆä¸ºç»“æ„åŒ–æ–‡æœ¬
     */
    fun formatCreativeIdea(idea: CreativeIdea): String {
        return buildString {
            // ã€åŸºæœ¬ä¿¡æ¯ã€‘
            appendLine("ã€åŸºæœ¬ä¿¡æ¯ã€‘")
            appendLine("- äº§å“ç±»å‹ï¼š${idea.productType.displayName}")
            appendLine("- é€‚ç”¨å¹´é¾„æ®µï¼š${idea.ageGroup.displayName}")
            appendLine("- è®¾è®¡ä¸»é¢˜ï¼š${simplifyTheme(idea.theme)}")
            appendLine()

            // ã€æ ¸å¿ƒè®¾è®¡ç‰¹ç‚¹ã€‘
            appendLine("ã€æ ¸å¿ƒè®¾è®¡ç‰¹ç‚¹ã€‘")
            val structuredFeatures = structureFeatures(idea.features, idea.productType)
            structuredFeatures.forEach { feature ->
                appendLine("- $feature")
            }
            appendLine()

            // ã€æ¨èææ–™ã€‘
            appendLine("ã€æ¨èææ–™ã€‘")
            idea.materials.forEach { material ->
                appendLine("- $material")
            }
            appendLine()

            // ã€åˆè§„å‚æ•°ã€‘
            appendLine("ã€åˆè§„å‚æ•°ã€‘")
            idea.complianceParameters?.let { params ->
                appendLine("- å¯¹åº”æ ‡å‡†ï¼š${formatStandards(idea.standardsReference)}")
                appendLine("- é€‚é…å‡äººï¼š${params.dummyType.displayName}")
                appendLine("- å®‰å…¨é˜ˆå€¼ï¼š")
                appendLine("  - HICæé™å€¼ï¼šâ‰¤${params.hicLimit}")
                appendLine("  - èƒ¸éƒ¨åŠ é€Ÿåº¦ï¼šâ‰¤${params.chestAccelerationLimit}g")
                appendLine("  - é¢ˆéƒ¨å¼ åŠ›ï¼šâ‰¤${params.neckTensionLimit}N")
                appendLine("  - å¤´éƒ¨ä½ç§»ï¼šâ‰¤${params.headExcursionLimit}mm")
                if (params.neckCompressionLimit > 0) {
                    appendLine("  - é¢ˆéƒ¨å‹ç¼©ï¼šâ‰¤${params.neckCompressionLimit}N")
                }
                if (params.kneeExcursionLimit > 0) {
                    appendLine("  - è†éƒ¨ä½ç§»ï¼šâ‰¤${params.kneeExcursionLimit}mm")
                }
                if (params.chestDeflectionLimit > 0) {
                    appendLine("  - èƒ¸éƒ¨ä½ç§»ï¼šâ‰¤${params.chestDeflectionLimit}mm")
                }
            }
            appendLine()

            // ã€å®‰å…¨æ³¨æ„äº‹é¡¹ã€‘
            appendLine("ã€å®‰å…¨æ³¨æ„äº‹é¡¹ã€‘")
            val structuredSafetyNotes = structureSafetyNotes(idea.safetyNotes)
            structuredSafetyNotes.forEach { note ->
                appendLine("- $note")
            }
        }
    }

    /**
     * ç®€åŒ–è®¾è®¡ä¸»é¢˜
     */
    private fun simplifyTheme(theme: String): String {
        val redundantWords = listOf("å„¿ç«¥", "å©´å¹¼å„¿", "å©´å¹¼å„¿ä¸“ç”¨")
        var simplified = theme
        redundantWords.forEach { word ->
            if (simplified.contains(word) && simplified.count { it == word[0] } > 1) {
                val firstIndex = simplified.indexOf(word)
                simplified = simplified.substring(0, firstIndex + word.length) +
                    simplified.substring(firstIndex + word.length).replace(word, "")
            }
        }
        return simplified
    }

    /**
     * ç»“æ„åŒ–æ ¸å¿ƒè®¾è®¡ç‰¹ç‚¹
     */
    private fun structureFeatures(
        features: List<String>,
        productType: ProductType
    ): List<String> {
        val installFeature = features.find { it.contains("å®‰è£…") || it.contains("è¿æ¥") || it.contains("ä¾¿æº") }
            ?: getInstallFeature(productType)

        val comfortFeature = features.find { it.contains("èˆ’é€‚") || it.contains("é èƒŒ") || it.contains("å¡«å……") }
            ?: getComfortFeature(productType)

        val materialFeature = features.find { it.contains("æè´¨") || it.contains("ææ–™") || it.contains("ç¯ä¿") }
            ?: getMaterialFeature(productType)

        val safetyFeature = features.find { it.contains("å®‰å…¨") || it.contains("æ ‡å‡†") || it.contains("ç¬¦åˆ") }
            ?: getSafetyFeature(productType)

        return listOfNotNull(
            installFeature?.let { "æ˜“å®‰è£…æ€§ï¼š${formatFeature(it)}" },
            comfortFeature?.let { "èˆ’é€‚æ€§ï¼š${formatFeature(it)}" },
            materialFeature?.let { "æè´¨ç¯ä¿ï¼š${formatFeature(it)}" },
            safetyFeature?.let { "å®‰å…¨æ€§ï¼š${formatFeature(it)}" }
        )
    }

    /**
     * æ ¼å¼åŒ–ç‰¹å¾æè¿°
     */
    private fun formatFeature(feature: String): String {
        val colonIndex = feature.indexOf("ï¼š")
        return if (colonIndex != -1) {
            feature.substring(colonIndex + 1).trim()
        } else {
            feature
        }
    }

    /**
     * è·å–æ˜“å®‰è£…æ€§ç‰¹å¾ï¼ˆé»˜è®¤å€¼ï¼‰
     */
    private fun getInstallFeature(productType: ProductType): String {
        return when (productType) {
            ProductType.CHILD_SAFETY_SEAT -> "æ”¯æŒISOFIXè¿æ¥ï¼Œå®ç°å¿«é€Ÿå®‰è£…"
            ProductType.BABY_STROLLER -> "æ”¯æŒä¸€é”®æŠ˜å ï¼Œæ”¶çº³ä¾¿æ·"
            ProductType.CHILD_HIGH_CHAIR -> "æ”¯æŒå¿«é€Ÿæ‹†è£…ï¼Œä¾¿äºæ¸…æ´"
            ProductType.CHILD_HOUSEHOLD_GOODS -> "ç»“æ„ç®€å•ï¼Œæ˜“äºç»„è£…"
        }
    }

    /**
     * è·å–èˆ’é€‚æ€§ç‰¹å¾ï¼ˆé»˜è®¤å€¼ï¼‰
     */
    private fun getComfortFeature(productType: ProductType): String {
        return when (productType) {
            ProductType.CHILD_SAFETY_SEAT -> "é‡‡ç”¨é«˜å›å¼¹æµ·ç»µå¡«å……ï¼Œè´´åˆå„¿ç«¥ä½“å‹"
            ProductType.BABY_STROLLER -> "é…å¤‡æ‚¬æŒ‚é¿éœ‡ç³»ç»Ÿï¼Œä¹˜åå¹³ç¨³èˆ’é€‚"
            ProductType.CHILD_HIGH_CHAIR -> "åº§æ¤…è§’åº¦å¤šæ¡£å¯è°ƒï¼Œé€‚åº”ä¸åŒåå§¿éœ€æ±‚"
            ProductType.CHILD_HOUSEHOLD_GOODS -> "äººä½“å·¥å­¦è®¾è®¡ï¼Œä½¿ç”¨èˆ’é€‚"
        }
    }

    /**
     * è·å–æè´¨ç¯ä¿ç‰¹å¾ï¼ˆé»˜è®¤å€¼ï¼‰
     */
    private fun getMaterialFeature(productType: ProductType): String {
        return when (productType) {
            ProductType.CHILD_SAFETY_SEAT -> "é€‰ç”¨é£Ÿå“çº§å®‰å…¨ææ–™ï¼Œæ— ç”²é†›/é‡é‡‘å±"
            ProductType.BABY_STROLLER -> "é€‰ç”¨æ— æ¯’ç¯ä¿ææ–™ï¼Œç¬¦åˆæ¬§ç›Ÿå®‰å…¨æ ‡å‡†"
            ProductType.CHILD_HIGH_CHAIR -> "é£Ÿå“çº§æè´¨ï¼Œå¯ç›´æ¥æ¥è§¦é£Ÿå“"
            ProductType.CHILD_HOUSEHOLD_GOODS -> "ç¯ä¿æè´¨ï¼Œå¯å›æ”¶åˆ©ç”¨"
        }
    }

    /**
     * è·å–å®‰å…¨æ€§ç‰¹å¾ï¼ˆé»˜è®¤å€¼ï¼‰
     */
    private fun getSafetyFeature(productType: ProductType): String {
        return when (productType) {
            ProductType.CHILD_SAFETY_SEAT -> "ç¬¦åˆUN R129 i-Size+GB 27887-2024å®‰å…¨è¦æ±‚"
            ProductType.BABY_STROLLER -> "ç¬¦åˆEN 1888å©´å„¿æ¨è½¦å®‰å…¨æ ‡å‡†"
            ProductType.CHILD_HIGH_CHAIR -> "ç¬¦åˆGB 22793-2008å„¿ç«¥é«˜æ¤…å®‰å…¨æ ‡å‡†"
            ProductType.CHILD_HOUSEHOLD_GOODS -> "ç¬¦åˆISO 8124å„¿ç«¥ç”¨å“å®‰å…¨è¦æ±‚"
        }
    }

    /**
     * ç»“æ„åŒ–å®‰å…¨æ³¨æ„äº‹é¡¹
     */
    private fun structureSafetyNotes(notes: List<String>): List<String> {
        val swallowRiskNote = notes.find { it.contains("åå’½") || it.contains("å°ºå¯¸") }
            ?: "æ‰€æœ‰éƒ¨ä»¶å°ºå¯¸å¤§äº3.5cmï¼Œé¿å…å„¿ç«¥åå’½é£é™©"

        val materialSafetyNote = notes.find { it.contains("ç”²é†›") || it.contains("é‡é‡‘å±") || it.contains("é£Ÿå“çº§") }
            ?: "ä½¿ç”¨é£Ÿå“çº§å®‰å…¨ææ–™ï¼Œæ— ç”²é†›ã€æ— é‡é‡‘å±æ®‹ç•™"

        val edgeSafetyNote = notes.find { it.contains("è¾¹ç¼˜") || it.contains("åœ†è§’") || it.contains("å°–é”") }
            ?: "äº§å“è¾¹ç¼˜åšåœ†è§’å¤„ç†ï¼ˆåŠå¾„â‰¥2mmï¼‰ï¼Œæ— å°–é”ç»“æ„"

        return listOf(swallowRiskNote, materialSafetyNote, edgeSafetyNote)
    }

    /**
     * æ ¼å¼åŒ–æ ‡å‡†ä¿¡æ¯
     */
    private fun formatStandards(standardsReference: StandardsReference?): String {
        return standardsReference?.mainStandard ?: "æ— æ ‡å‡†å…³è”"
    }
}
```

---

## ğŸ¯ æœåŠ¡å±‚

### 1. åˆ›æ„æœåŠ¡ (CreativeService.kt)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/childproduct/designassistant/service/CreativeService.kt`

```kotlin
package com.childproduct.designassistant.service

import com.childproduct.designassistant.model.*
import com.childproduct.designassistant.utils.ComplianceParamsData
import com.childproduct.designassistant.utils.DesignSchemeFormatter
import com.childproduct.designassistant.utils.OutputComplianceChecker
import com.childproduct.designassistant.utils.SchemeCardData
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext
import java.util.UUID

class CreativeService {

    private val ageGroupThemes = mapOf(
        AgeGroup.INFANT to listOf("æŸ”å’Œè‰²å½©", "åœ†å½¢è®¾è®¡", "å®‰å…¨ææ–™", "è§¦æ„Ÿåˆºæ¿€"),
        AgeGroup.TODDLER to listOf("é²œè‰³è‰²å½©", "ç®€å•äº’åŠ¨", "å¤§å°ºå¯¸", "è€æ‘”ææ–™"),
        AgeGroup.PRESCHOOL to listOf("æ•™è‚²ä¸»é¢˜", "åˆ›æ„æ¶‚é¸¦", "è§’è‰²æ‰®æ¼”", "æ‹¼å›¾æ¸¸æˆ"),
        AgeGroup.SCHOOL_AGE to listOf("ç§‘æŠ€å…ƒç´ ", "å›¢é˜Ÿåˆä½œ", "æ¢ç´¢å‘ç°", "ç«æŠ€æŒ‘æˆ˜"),
        AgeGroup.TEEN to listOf("ä¸ªæ€§åŒ–è®¾è®¡", "ç¤¾äº¤å…ƒç´ ", "æŠ€èƒ½åŸ¹å…»", "æ½®æµé£æ ¼")
    )

    private val productTypeFeatures = mapOf(
        ProductType.CHILD_SAFETY_SEAT to listOf("å®‰å…¨æ€§", "èˆ’é€‚æ€§", "æ˜“å®‰è£…æ€§", "æè´¨ç¯ä¿"),
        ProductType.BABY_STROLLER to listOf("æŠ˜å ä¾¿æº", "é¿éœ‡ç³»ç»Ÿ", "ç¨³å›ºæ€§", "å‚¨ç‰©åŠŸèƒ½"),
        ProductType.CHILD_HOUSEHOLD_GOODS to listOf("å®‰å…¨è®¾è®¡", "æ˜“æ¸…æ´", "è€ä¹…æ€§", "é€‚é¾„æ€§"),
        ProductType.CHILD_HIGH_CHAIR to listOf("ç¨³å®šæ€§", "å¯è°ƒèŠ‚é«˜åº¦", "å®‰å…¨å¸¦ç³»ç»Ÿ", "æ˜“æ¸…æ´")
    )

    private val colorPalettes = mapOf(
        AgeGroup.INFANT to listOf("#FFB6C1", "#E0FFFF", "#F0E68C", "#E6E6FA"),
        AgeGroup.TODDLER to listOf("#FF6347", "#4169E1", "#32CD32", "#FFD700"),
        AgeGroup.PRESCHOOL to listOf("#FF69B4", "#00CED1", "#FFA500", "#9370DB"),
        AgeGroup.SCHOOL_AGE to listOf("#1E90FF", "#00FA9A", "#FF4500", "#9932CC"),
        AgeGroup.TEEN to listOf("#000000", "#FFFFFF", "#808080", "#C0C0C0", "#FF1493")
    )

    private val materialSuggestions = mapOf(
        ProductType.CHILD_SAFETY_SEAT to listOf("é£Ÿå“çº§PPå¡‘æ–™", "é«˜å›å¼¹æµ·ç»µ", "å®‰å…¨å¸¦ç»‡å¸¦", "é“åˆé‡‘æ”¯æ¶"),
        ProductType.BABY_STROLLER to listOf("é“åˆé‡‘æ¡†æ¶", "è€ç£¨ç‰›æ´¥å¸ƒ", "EVAå‘æ³¡è½®å­", "ä¸é”ˆé’¢è½¦è½´"),
        ProductType.CHILD_HOUSEHOLD_GOODS to listOf("ABSç¯ä¿å¡‘æ–™", "å®æœ¨ï¼ˆæ¦‰æœ¨/æ¡¦æœ¨ï¼‰", "é£Ÿå“çº§ç¡…èƒ¶", "ä¸é”ˆé’¢é…ä»¶"),
        ProductType.CHILD_HIGH_CHAIR to listOf("å®æœ¨ï¼ˆæ¦‰æœ¨ï¼‰", "é£Ÿå“çº§PPå¡‘æ–™", "ä¸é”ˆé’¢èºä¸", "ç¯ä¿æ¶‚å±‚")
    )

    suspend fun generateCreativeIdea(
        ageGroup: AgeGroup,
        productType: ProductType,
        customTheme: String = ""
    ): CreativeIdea = withContext(Dispatchers.IO) {
        val themes = ageGroupThemes[ageGroup] ?: emptyList()
        val features = productTypeFeatures[productType] ?: emptyList()
        val colors = colorPalettes[ageGroup] ?: emptyList()
        val materials = materialSuggestions[productType] ?: listOf("å¡‘æ–™", "æœ¨è´¨", "é‡‘å±", "å¸ƒæ–™")

        val finalTheme = if (customTheme.isNotEmpty()) customTheme else themes.random()
        val selectedFeatures = features.shuffled().take(4)
        val selectedColors = colors.shuffled().take(4)

        val title = generateTitle(ageGroup, productType, finalTheme)
        val description = generateDescription(ageGroup, productType, finalTheme, selectedFeatures)
        val safetyNotes = generateSafetyNotes(ageGroup, productType)

        // è·å–å¯¹åº”çš„å‡äººç±»å‹
        val dummyType = CrashTestDummy.getByAgeGroup(ageGroup)

        // ç”Ÿæˆä¸“ä¸šåˆè§„å‚æ•°ï¼ˆåŸºäºå‡äººç±»å‹ï¼‰
        val complianceParameters = ComplianceParameters.getByDummy(dummyType)

        // ç”Ÿæˆæ ‡å‡†å…³è”ï¼ˆæ ¹æ®äº§å“ç±»å‹ï¼‰
        val standardsReference = StandardsReference.getDefaultForProductType(productType)

        // ç”Ÿæˆæè´¨è§„æ ¼ï¼ˆæ ¹æ®äº§å“ç±»å‹ï¼‰
        val materialSpecs = MaterialSpecs.getDefaultForProductType(productType)

        CreativeIdea(
            id = UUID.randomUUID().toString(),
            title = title,
            description = description,
            ageGroup = ageGroup,
            productType = productType,
            theme = finalTheme,
            features = selectedFeatures,
            materials = materials,
            colorPalette = selectedColors,
            safetyNotes = safetyNotes,
            complianceParameters = complianceParameters,
            standardsReference = standardsReference,
            materialSpecs = materialSpecs
        )
    }

    /**
     * åŸºäºèº«é«˜èŒƒå›´ç”Ÿæˆåˆ›æ„ï¼ˆæ–°å¢ï¼‰
     */
    suspend fun generateCreativeIdeaByHeight(
        minHeightCm: Int,
        maxHeightCm: Int,
        productType: ProductType,
        customTheme: String = ""
    ): CreativeIdeaResult = withContext(Dispatchers.IO) {
        // å¼ºåˆ¶è§„åˆ™ï¼šèº«é«˜40-150cm â†’ 0-12å²ï¼ˆAgeGroup.ALLï¼‰
        val ageGroup = if (minHeightCm >= 40 && maxHeightCm <= 150) {
            AgeGroup.ALL  // å¼ºåˆ¶æ˜ å°„åˆ°0-12å²
        } else {
            // å¦‚æœèŒƒå›´è¶…å‡ºï¼Œæ ¹æ®ä¸­é—´é«˜åº¦æ˜ å°„
            val middleHeight = (minHeightCm + maxHeightCm) / 2
            val dummyType = CrashTestMapping.getDummyByHeight(middleHeight)
            when {
                dummyType == CrashTestDummy.Q0 || dummyType == CrashTestDummy.Q0_PLUS -> AgeGroup.INFANT
                dummyType == CrashTestDummy.Q1 || dummyType == CrashTestDummy.Q1_5 -> AgeGroup.TODDLER
                dummyType == CrashTestDummy.Q3 -> AgeGroup.PRESCHOOL
                dummyType == CrashTestDummy.Q3_S -> AgeGroup.SCHOOL_AGE
                else -> AgeGroup.TEEN
            }
        }

        // éªŒè¯èº«é«˜èŒƒå›´
        val validation = CrashTestMapping.validateHeightRange(minHeightCm, maxHeightCm)

        if (!validation.isValid) {
            return@withContext CreativeIdeaResult(
                success = false,
                error = validation.errors.joinToString("; "),
                idea = null,
                validation = validation
            )
        }

        // è·å–æ‰€æœ‰æ¶‰åŠçš„å‡äººç±»å‹
        val dummyTypes = HeightAgeMappingConfig.getIntervalsByHeightRange(
            minHeightCm.toDouble(),
            maxHeightCm.toDouble()
        ).map { it.dummyType }.distinct()

        // ä½¿ç”¨ä¸­é—´å‡äººç±»å‹ä½œä¸ºä¸»è¦å‚è€ƒ
        val mainDummyType = CrashTestMapping.getDummyByHeight((minHeightCm + maxHeightCm) / 2)
        val dummyType = mainDummyType  // ç”¨äºåç»­ç”Ÿæˆ

        val themes = ageGroupThemes[ageGroup] ?: emptyList()
        val features = productTypeFeatures[productType] ?: emptyList()
        val colors = colorPalettes[ageGroup] ?: emptyList()
        val materials = materialSuggestions[productType] ?: listOf("å¡‘æ–™", "æœ¨è´¨", "é‡‘å±", "å¸ƒæ–™")

        val finalTheme = if (customTheme.isNotEmpty()) customTheme else themes.random()
        val selectedFeatures = features.shuffled().take(4)
        val selectedColors = colors.shuffled().take(4)

        val title = generateTitle(ageGroup, productType, finalTheme)
        val description = generateDescription(ageGroup, productType, finalTheme, selectedFeatures)
        val safetyNotes = generateSafetyNotes(ageGroup, productType)

        // ç”Ÿæˆä¸“ä¸šåˆè§„å‚æ•°ï¼ˆåŸºäºå‡äººç±»å‹ï¼‰
        val complianceParameters = ComplianceParameters.getByDummy(dummyType)

        // ç”Ÿæˆæ ‡å‡†å…³è”ï¼ˆæ ¹æ®äº§å“ç±»å‹ï¼‰
        val standardsReference = StandardsReference.getDefaultForProductType(productType)

        // ç”Ÿæˆæè´¨è§„æ ¼ï¼ˆæ ¹æ®äº§å“ç±»å‹ï¼‰
        val materialSpecs = MaterialSpecs.getDefaultForProductType(productType)

        // ç”Ÿæˆå¹´é¾„ä¿®æ­£æç¤ºï¼ˆå¦‚æœéœ€è¦ï¼‰
        val ageCorrectionHint = if (ageGroup == AgeGroup.ALL) {
            HeightAgeMappingConfig.getCorrectionHint()
        } else {
            null
        }

        // ç”Ÿæˆæ ‡å‡†åˆè§„æ€§è¯´æ˜
        val standardComplianceText = HeightAgeMappingConfig.getStandardComplianceText()

        val idea = CreativeIdea(
            id = UUID.randomUUID().toString(),
            title = title,
            description = description,
            ageGroup = ageGroup,
            productType = productType,
            theme = finalTheme,
            features = selectedFeatures,
            materials = materials,
            colorPalette = selectedColors,
            safetyNotes = safetyNotes,
            complianceParameters = complianceParameters,
            standardsReference = standardsReference,
            materialSpecs = materialSpecs
        )

        CreativeIdeaResult(
            success = true,
            error = null,
            idea = idea,
            validation = validation,
            ageCorrectionHint = ageCorrectionHint,
            standardComplianceText = standardComplianceText
        )
    }

    private fun generateTitle(ageGroup: AgeGroup, productType: ProductType, theme: String): String {
        return when {
            ageGroup == AgeGroup.INFANT && productType == ProductType.CHILD_SAFETY_SEAT ->
                "å©´å¹¼å„¿ä¸“ç”¨${productType.displayName} - $theme"
            ageGroup == AgeGroup.INFANT && productType == ProductType.BABY_STROLLER ->
                "å©´å¹¼å„¿æ¨è½¦ - $theme"
            // ... æ›´å¤šç»„åˆ
            else ->
                "${ageGroup.displayName}${productType.displayName} - $theme"
        }
    }

    private fun generateDescription(
        ageGroup: AgeGroup,
        productType: ProductType,
        theme: String,
        features: List<String>
    ): String {
        return """
            é’ˆå¯¹${ageGroup.displayName}è®¾è®¡çš„${productType.displayName}ï¼Œä¸»é¢˜ä¸º"$theme"ã€‚
            æ ¸å¿ƒç‰¹ç‚¹ï¼š${features.joinToString("ã€")}
        """.trimIndent()
    }

    private fun generateSafetyNotes(ageGroup: AgeGroup, productType: ProductType): List<String> {
        return listOf(
            "ç¬¦åˆ${productType.mainStandards}å®‰å…¨æ ‡å‡†",
            "é€‚åˆ${ageGroup.displayName}ä½¿ç”¨",
            "é‡‡ç”¨é£Ÿå“çº§å®‰å…¨ææ–™",
            "é€šè¿‡CEã€FCCç­‰å›½é™…è®¤è¯"
        )
    }

    /**
     * æ ¼å¼åŒ–æ–¹æ¡ˆè¾“å‡ºï¼ˆä½¿ç”¨OutputComplianceCheckerï¼‰
     */
    fun getFormattedScheme(idea: CreativeIdea): String {
        val rawOutput = DesignSchemeFormatter.formatCreativeIdea(idea)
        // ä½¿ç”¨ä¼˜åŒ–å·¥å…·æ¸…ç†è¾“å‡º
        return OutputComplianceChecker.checkAndFixOutput(
            rawOutput,
            inputHeightRange = "40-150cm",  // é»˜è®¤èº«é«˜èŒƒå›´
            productType = idea.productType.displayName
        )
    }

    /**
     * åŸºäºèº«é«˜èŒƒå›´æ ¼å¼åŒ–æ–¹æ¡ˆ
     */
    fun getFormattedSchemeWithHeight(
        idea: CreativeIdea,
        minHeightCm: Int,
        maxHeightCm: Int
    ): String {
        val rawOutput = DesignSchemeFormatter.formatCreativeIdea(idea)
        // ä½¿ç”¨ä¼˜åŒ–å·¥å…·æ¸…ç†è¾“å‡ºï¼Œå¹¶æŒ‡å®šèº«é«˜èŒƒå›´
        return OutputComplianceChecker.checkAndFixOutput(
            rawOutput,
            inputHeightRange = "${minHeightCm}-${maxHeightCm}cm",
            productType = idea.productType.displayName
        )
    }
}
```

---

## ğŸ–¥ï¸ UIå±‚

### 1. è®¾è®¡æ–¹æ¡ˆé¡µé¢ (DesignActivity.kt)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/childproduct/designassistant/ui/DesignActivity.kt`

```kotlin
package com.childproduct.designassistant.ui

import android.os.Bundle
import android.widget.Button
import android.widget.EditText
import android.widget.RadioGroup
import android.widget.TextView
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import com.childproduct.designassistant.R
import com.childproduct.designassistant.helper.SchemeOptimizer
import com.childproduct.designassistant.helper.UiHelper
import com.childproduct.designassistant.model.InstallMethod

class DesignActivity : AppCompatActivity() {
    // UIæ§ä»¶
    private lateinit var rgInstallMethod: RadioGroup
    private lateinit var etProductType: EditText // å®é™…é¡¹ç›®å»ºè®®ç”¨Spinneré€‰æ‹©äº§å“ç±»å‹
    private lateinit var etHeightRange: EditText
    private lateinit var etThemeKeyword: EditText
    private lateinit var btnGenerate: Button
    private lateinit var tvResult: TextView

    // é€‰ä¸­çš„å®‰è£…æ–¹å¼ï¼ˆé»˜è®¤ç¬¬ä¸€ä¸ªï¼‰
    private var selectedInstallMethod: InstallMethod = InstallMethod.ISOFIX

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_design) // éœ€è‡ªè¡Œåˆ›å»ºå¯¹åº”çš„XMLå¸ƒå±€

        // åˆå§‹åŒ–UIæ§ä»¶
        initViews()

        // åˆå§‹åŒ–å®‰è£…æ–¹å¼å•é€‰ç»„
        initInstallMethodRadioGroup()

        // ç”ŸæˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
        setupGenerateButtonListener()
    }

    private fun initViews() {
        rgInstallMethod = findViewById(R.id.rg_install_method)
        etProductType = findViewById(R.id.et_product_type)
        etHeightRange = findViewById(R.id.et_height_range)
        etThemeKeyword = findViewById(R.id.et_theme_keyword)
        btnGenerate = findViewById(R.id.btn_generate)
        tvResult = findViewById(R.id.tv_result)

        // é¢„è®¾ç¤ºä¾‹è¾“å…¥ï¼ˆæå‡ç”¨æˆ·ä½“éªŒï¼‰
        etProductType.hint = "å¦‚ï¼šå„¿ç«¥å®‰å…¨åº§æ¤…"
        etHeightRange.hint = "å¦‚ï¼š40-150cm"
        etThemeKeyword.hint = "å¦‚ï¼šæ‹¼å›¾æ¸¸æˆã€å¡é€šå›¾æ¡ˆ"
    }

    private fun initInstallMethodRadioGroup() {
        // è°ƒç”¨UIè¾…åŠ©ç±»ï¼ŒåŠ¨æ€ç”Ÿæˆå®‰è£…æ–¹å¼å•é€‰æŒ‰é’®
        UiHelper.setupInstallMethodRadioGroup(this, rgInstallMethod) { method ->
            selectedInstallMethod = method
        }
    }

    private fun setupGenerateButtonListener() {
        btnGenerate.setOnClickListener {
            // 1. è·å–ç”¨æˆ·è¾“å…¥
            val userInput = SchemeOptimizer.UserInput(
                productType = etProductType.text.toString().trim(),
                heightRange = etHeightRange.text.toString().trim(),
                installMethod = selectedInstallMethod,
                themeKeyword = etThemeKeyword.text.toString().trim()
            )

            // 2. éªŒè¯è¾“å…¥åˆæ³•æ€§
            val validateError = UiHelper.validateUserInput(userInput)
            if (validateError != null) {
                Toast.makeText(this, validateError, Toast.LENGTH_SHORT).show()
                return@setOnClickListener
            }

            // 3. ç”Ÿæˆä¼˜åŒ–åçš„è®¾è®¡æ–¹æ¡ˆ
            val optimizedScheme = SchemeOptimizer.generateOptimizedScheme(userInput)

            // 4. æ ¼å¼åŒ–æ–¹æ¡ˆå¹¶å±•ç¤ºåˆ°UI
            val displayText = SchemeOptimizer.formatSchemeForDisplay(optimizedScheme)
            tvResult.text = displayText
        }
    }
}
```

---

### 2. æŠ€æœ¯å»ºè®®é¡µé¢ (TechnicalRecommendationScreen.kt)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/childproduct/designassistant/ui/screens/TechnicalRecommendationScreen.kt`

```kotlin
package com.childproduct.designassistant.ui.screens

import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.text.KeyboardOptions
import androidx.compose.foundation.verticalScroll
import androidx.compose.foundation.clickable
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.*
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.input.KeyboardType
import androidx.compose.ui.unit.dp
import com.childproduct.designassistant.data.*
import com.childproduct.designassistant.model.*
import com.childproduct.designassistant.ui.MainViewModel
import com.childproduct.designassistant.ui.UiState
import com.childproduct.designassistant.ui.components.StandardClauseDialog
import com.childproduct.designassistant.ui.components.common.InfoRow

/**
 * ä¸“ä¸šå¯¼å‘å‹æŠ€æœ¯å»ºè®®ç•Œé¢
 * æ ‡é¢˜ï¼šæ ‡å‡†é€‚é…è®¾è®¡
 * åŠŸèƒ½ï¼šåŸºäºæ³•è§„æ ‡å‡†è¾“å‡ºè®¾è®¡ä¾æ®ï¼Œæ”¯æŒæ ‡å‡†å…³é”®è¯è”æƒ³ã€å‚æ•°é¢„è§ˆ
 */
@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun TechnicalRecommendationScreen(
    viewModel: MainViewModel,
    modifier: Modifier = Modifier
) {
    val uiState by viewModel.uiState.collectAsState()

    // è¾“å…¥çŠ¶æ€
    var minHeight by remember { mutableStateOf("") }
    var maxHeight by remember { mutableStateOf("") }
    var selectedProductType by remember { mutableStateOf(ProductType.CHILD_SAFETY_SEAT) }
    var selectedConfigurations by remember { mutableStateOf<Set<String>>(emptySet()) }
    var designRequirement by remember { mutableStateOf("") }

    // å®æ—¶åŒ¹é…ç»“æœ
    var standardMatchResult by remember { mutableStateOf<StandardMatchResult?>(null) }
    var designParameters by remember { mutableStateOf<List<DesignParameter>>(emptyList()) }
    var complianceTests by remember { mutableStateOf<List<ComplianceTestItem>>(emptyList()) }

    // æ ‡å‡†å‚æ•°é¢„è§ˆ
    var parameterPreviews by remember { mutableStateOf<List<StandardParameterPreview>>(emptyList()) }
    var showParameterPreview by remember { mutableStateOf(true) }

    // æ ‡å‡†å…³é”®è¯è”æƒ³
    var keywordSuggestions by remember { mutableStateOf<List<StandardKeywordSuggestion>>(emptyList()) }

    // æ¡æ¬¾å¯¹è¯æ¡†çŠ¶æ€
    var selectedClause by remember { mutableStateOf<StandardClause?>(null) }
    var showClauseDialog by remember { mutableStateOf(false) }

    // æœåŠ¡å®ä¾‹
    val matchingService = remember { StandardMatchingService() }
    val previewService = remember { StandardParameterPreviewService() }
    val suggestionService = remember { StandardKeywordSuggestionService() }

    // å®æ—¶æ ‡å‡†åŒ¹é…é€»è¾‘
    LaunchedEffect(minHeight, maxHeight, selectedProductType) {
        val minHeightInt = minHeight.toIntOrNull()
        val maxHeightInt = maxHeight.toIntOrNull()

        if (minHeightInt != null && maxHeightInt != null && minHeightInt <= maxHeightInt) {
            standardMatchResult = matchingService.matchStandardByHeight(
                minHeightInt,
                maxHeightInt,
                selectedProductType
            )
            // æ›´æ–°å‚æ•°é¢„è§ˆ
            parameterPreviews = previewService.getParameterPreview(
                selectedProductType,
                minHeightInt,
                maxHeightInt
            )
        } else {
            standardMatchResult = null
            parameterPreviews = emptyList()
        }
    }

    // å…³é”®è¯è”æƒ³é€»è¾‘
    LaunchedEffect(designRequirement) {
        keywordSuggestions = suggestionService.getSuggestions(designRequirement)
    }

    // å½“é…ç½®å˜åŒ–æ—¶æ›´æ–°è®¾è®¡å‚æ•°å’Œæµ‹è¯•çŸ©é˜µ
    LaunchedEffect(selectedProductType, selectedConfigurations, minHeight, maxHeight) {
        val heightRange = HeightRangeInput(minHeight, maxHeight)
        val configs = ChildSafetySeatConfigurations.getConfigurationsForProduct(selectedProductType)
            .filter { selectedConfigurations.contains(it.configId) }

        designParameters = matchingService.getDesignParameters(
            selectedProductType,
            configs,
            heightRange
        )

        complianceTests = matchingService.getComplianceTests(
            selectedProductType,
            configs
        )
    }

    Column(
        modifier = modifier
            .fillMaxSize()
            .padding(16.dp)
            .verticalScroll(rememberScrollState())
    ) {
        // é¡µé¢æ ‡é¢˜ï¼ˆæ ‡å°º+æ ‡å‡†æ–‡æ¡£å›¾æ ‡ï¼‰
        Row(
            verticalAlignment = Alignment.CenterVertically,
            modifier = Modifier.padding(bottom = 16.dp)
        ) {
            Icon(
                imageVector = Icons.Default.Straighten,
                contentDescription = null,
                tint = MaterialTheme.colorScheme.primary,
                modifier = Modifier.padding(end = 8.dp)
            )
            Icon(
                imageVector = Icons.Default.LibraryBooks,
                contentDescription = null,
                tint = MaterialTheme.colorScheme.primary,
                modifier = Modifier.padding(end = 8.dp)
            )
            Text(
                text = "æ ‡å‡†é€‚é…è®¾è®¡",
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.primary
            )
        }

        // è¾“å…¥è¡¨å•
        Card(
            modifier = Modifier.fillMaxWidth(),
            elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)
        ) {
            Column(
                modifier = Modifier.padding(16.dp),
                verticalArrangement = Arrangement.spacedBy(16.dp)
            ) {
                // èº«é«˜èŒƒå›´è¾“å…¥ï¼ˆåŒæ ï¼‰
                Text(
                    text = "èº«é«˜èŒƒå›´è¾“å…¥ï¼ˆcmï¼‰",
                    style = MaterialTheme.typography.titleMedium,
                    fontWeight = FontWeight.Bold
                )

                Row(
                    modifier = Modifier.fillMaxWidth(),
                    horizontalArrangement = Arrangement.spacedBy(12.dp)
                ) {
                    OutlinedTextField(
                        value = minHeight,
                        onValueChange = {
                            if (it.isEmpty() || it.all { char -> char.isDigit() }) {
                                minHeight = it
                            }
                        },
                        label = { Text("æœ€å°èº«é«˜") },
                        modifier = Modifier.weight(1f),
                        singleLine = true,
                        placeholder = { Text("å¦‚: 40") },
                        keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)
                    )

                    OutlinedTextField(
                        value = maxHeight,
                        onValueChange = {
                            if (it.isEmpty() || it.all { char -> char.isDigit() }) {
                                maxHeight = it
                            }
                        },
                        label = { Text("æœ€å¤§èº«é«˜") },
                        modifier = Modifier.weight(1f),
                        singleLine = true,
                        placeholder = { Text("å¦‚: 105") },
                        keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)
                    )
                }

                // å®æ—¶åŒ¹é…ç»“æœæ˜¾ç¤º
                standardMatchResult?.let { result ->
                    StandardMatchResultCard(result = result)
                }

                // ... æ›´å¤šUIç»„ä»¶
            }
        }
    }
}
```

---

## ğŸ“± å¸ƒå±€æ–‡ä»¶

### 1. è®¾è®¡æ–¹æ¡ˆé¡µé¢å¸ƒå±€ (activity_design.xml)

**æ–‡ä»¶è·¯å¾„**: `app/src/main/res/layout/activity_design.xml`

```xml
<?xml version="1.0" encoding="utf-8"?>
<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:padding="16dp">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical">

        <!-- äº§å“ç±»å‹è¾“å…¥ -->
        <EditText
            android:id="@+id/et_product_type"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:inputType="text"
            android:hint="è¯·è¾“å…¥äº§å“ç±»å‹ï¼ˆå¦‚ï¼šå„¿ç«¥å®‰å…¨åº§æ¤…ï¼‰" />

        <!-- èº«é«˜èŒƒå›´è¾“å…¥ -->
        <EditText
            android:id="@+id/et_height_range"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:inputType="text"
            android:hint="è¯·è¾“å…¥èº«é«˜èŒƒå›´ï¼ˆå¦‚ï¼š40-150cmï¼‰"
            android:layout_marginTop="16dp" />

        <!-- å®‰è£…æ–¹å¼å•é€‰ç»„ -->
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="é€‰æ‹©å®‰è£…æ–¹å¼ï¼š"
            android:textSize="16sp"
            android:textStyle="bold"
            android:layout_marginTop="16dp" />

        <RadioGroup
            android:id="@+id/rg_install_method"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:layout_marginTop="8dp" />

        <!-- è®¾è®¡ä¸»é¢˜å…³é”®è¯è¾“å…¥ -->
        <EditText
            android:id="@+id/et_theme_keyword"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:inputType="text"
            android:hint="è¯·è¾“å…¥è®¾è®¡ä¸»é¢˜å…³é”®è¯ï¼ˆå¦‚ï¼šæ‹¼å›¾æ¸¸æˆï¼‰"
            android:layout_marginTop="16dp" />

        <!-- ç”ŸæˆæŒ‰é’® -->
        <Button
            android:id="@+id/btn_generate"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="ç”Ÿæˆè®¾è®¡æ–¹æ¡ˆ"
            android:layout_marginTop="16dp" />

        <!-- ç»“æœå±•ç¤º -->
        <TextView
            android:id="@+id/tv_result"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:textSize="14sp"
            android:lineSpacingExtra="4dp"
            android:layout_marginTop="16dp"
            android:text="è®¾è®¡æ–¹æ¡ˆå°†åœ¨è¿™é‡Œæ˜¾ç¤º..." />

    </LinearLayout>

</ScrollView>
```

---

## ğŸ“Š é¡¹ç›®æ¶æ„æ€»ç»“

### åŠŸèƒ½æ¨¡å—åˆ’åˆ†

1. **æ•°æ®æ¨¡å‹å±‚** (`app/src/main/java/com/childproduct/designassistant/model/`)
   - `InstallMethod.kt` - å®‰è£…æ–¹å¼æšä¸¾
   - `TestMatrix.kt` - æµ‹è¯•çŸ©é˜µæ¨¡å‹
   - `ChildProductDesignScheme.kt` - æ ‡å‡†åŒ–è®¾è®¡æ–¹æ¡ˆæ¨¡å‹
   - `UserInput.kt` - ç”¨æˆ·è¾“å…¥æ¨¡å‹
   - `ComplianceParameters.kt` - åˆè§„å‚æ•°æ¨¡å‹
   - `CrashTestMapping.kt` - ç¢°æ’æµ‹è¯•æ˜ å°„ç³»ç»Ÿ
   - `HeightAgeMappingConfig.kt` - èº«é«˜-å¹´é¾„æ®µæ˜ å°„é…ç½®

2. **å·¥å…·ç±»å±‚** (`app/src/main/java/com/childproduct/designassistant/helper/` & `utils/`)
   - `SchemeOptimizer.kt` - æ–¹æ¡ˆä¼˜åŒ–å·¥å…·ï¼ˆæ ¸å¿ƒï¼‰
   - `UiHelper.kt` - UIäº¤äº’è¾…åŠ©ç±»
   - `OutputComplianceChecker.kt` - è¾“å‡ºåˆè§„æ£€æŸ¥å™¨
   - `DesignSchemeFormatter.kt` - è®¾è®¡æ–¹æ¡ˆæ ¼å¼åŒ–å™¨

3. **æœåŠ¡å±‚** (`app/src/main/java/com/childproduct/designassistant/service/`)
   - `CreativeService.kt` - åˆ›æ„ç”ŸæˆæœåŠ¡

4. **UIå±‚** (`app/src/main/java/com/childproduct/designassistant/ui/`)
   - `DesignActivity.kt` - è®¾è®¡æ–¹æ¡ˆé¡µé¢
   - `screens/TechnicalRecommendationScreen.kt` - æŠ€æœ¯å»ºè®®é¡µé¢

5. **å¸ƒå±€æ–‡ä»¶** (`app/src/main/res/layout/`)
   - `activity_design.xml` - è®¾è®¡æ–¹æ¡ˆé¡µé¢å¸ƒå±€

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### 1. åˆ›æ„ç”Ÿæˆ
- æ”¯æŒåŸºäºèº«é«˜èŒƒå›´ç”Ÿæˆåˆ›æ„
- è‡ªåŠ¨åŒ¹é…å¹´é¾„æ®µå’Œå‡äººç±»å‹
- åŠ¨æ€ç”Ÿæˆæ ¸å¿ƒè®¾è®¡ç‰¹ç‚¹
- æ™ºèƒ½æ¨èææ–™å’Œé¢œè‰²

### 2. å®‰å…¨æ£€æŸ¥
- ç¬¦åˆ UN R129 / GB 27887-2024 / FMVSS 213 æ ‡å‡†
- è‡ªåŠ¨ä¿®æ­£èº«é«˜-å¹´é¾„æ®µ-å‡äººåŒ¹é…é”™è¯¯
- ç”Ÿæˆç»“æ„åŒ–æµ‹è¯•çŸ©é˜µ
- å®æ—¶å‚æ•°é¢„è§ˆ

### 3. æŠ€æœ¯å»ºè®®
- åŸºäºæ³•è§„æ ‡å‡†è¾“å‡ºè®¾è®¡ä¾æ®
- æ”¯æŒæ ‡å‡†å…³é”®è¯è”æƒ³
- åŠ¨æ€è®¡ç®—å®‰å…¨é˜ˆå€¼
- ç”Ÿæˆåˆè§„æ€§è¯´æ˜

### 4. ä¼˜åŒ–å·¥å…·
- å…¨ç»´åº¦ä¹±ç æ¸…ç†
- è‡ªåŠ¨å»é‡å’Œæ ¼å¼åŒ–
- æ ‡å‡†å‚æ•°æ˜ å°„
- ç»“æ„åŒ–è¾“å‡º

---

## ğŸ“ æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Kotlin 1.9.22
- **UIæ¡†æ¶**: Jetpack Compose BOM 2024.06.00
- **ç¼–è¯‘å™¨**: Compose Compiler 1.5.10
- **æ„å»ºå·¥å…·**: Gradle 8.2.0
- **ç›®æ ‡SDK**: Android SDK 34

---

## ğŸ”„ æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥ â†’ SchemeOptimizer â†’ ChildProductDesignScheme â†’ OutputComplianceChecker â†’ UIå±•ç¤º
                â†“
          CreativeService
                â†“
          DesignSchemeFormatter
```

---

## ğŸ“Œ å…³é”®å†³ç­–è®°å½•

1. **åˆ›å»º `OutputComplianceChecker` å·¥å…·ç±»**
   - è‡ªåŠ¨æ£€æµ‹å¹¶ä¿®æ­£è¾“å‡ºç»“æœä¸­çš„ä¹±ç ã€å‚æ•°é”™è¯¯ã€æ’ç‰ˆæ‚ä¹±ç­‰é—®é¢˜

2. **åˆ›å»º `ChildProductDesignScheme` æ ‡å‡†åŒ–æ•°æ®æ¨¡å‹**
   - æ›¿ä»£æ‚ä¹±ä»£ç å­—æ®µï¼Œæ¶ˆé™¤ä¹±ç /å†—ä½™æ ¹æº

3. **å»ºç«‹æ ‡å‡†æ˜ å°„è¡¨ `STANDARD_MAPPING`**
   - å¼ºåˆ¶ä¿®æ­£èº«é«˜-å¹´é¾„æ®µ-å‡äººåŒ¹é…é”™è¯¯ï¼ˆå¦‚40-150cmå¼ºåˆ¶æ˜ å°„ä¸º0-12å²+Q0-Q10ï¼‰

4. **åœ¨ `CreativeService` ä¸­é›†æˆä¼˜åŒ–å·¥å…·**
   - åœ¨ `getFormattedScheme` å’Œ `getFormattedSchemeWithHeight` æ–¹æ³•ä¸­è°ƒç”¨æ ¡éªŒé€»è¾‘

---

**æ–‡æ¡£ç»“æŸ**

> æœ¬æ–‡æ¡£å·²æå–é¡¹ç›®æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ä»£ç ï¼ŒæŒ‰ç…§æ¨¡å—åŒ–æ–¹å¼ç»„ç»‡ï¼Œä¾¿äºæŸ¥é˜…å’Œç»´æŠ¤ã€‚
