# 儿童产品设计辅助APK - 优化计划文档

## 项目概述

本文档记录"儿童产品设计辅助APK"的系统性优化计划，聚焦**儿童安全座椅**和**婴儿推车**两大核心品类，提供专业化、可落地的设计建议。

## 优化目标

1. **专业性**：基于国际标准（ECE R129、FMVSS 213、EN 1888等）和头部品牌参数
2. **智能化**：集成大语言模型，生成结构化设计建议
3. **易用性**：手机端人性化体验，简化操作流程
4. **自动化**：GitHub Actions CI/CD，实现代码管理与APK构建自动化

---

## 第一阶段：核心架构搭建 ✅ 已完成

### 1.1 产品标准数据模型

**文件**: `app/src/main/java/com/childproduct/designassistant/model/ProductStandard.kt`

**功能**:
- ✅ 国际标准枚举（ECE R129/i-Size、FMVSS 213、EN 1888、ASTM F833）
- ✅ 产品细分类型
  - 儿童安全座椅：Group 0+/1/2/3、ISOFIX接口型、便携型、可旋转型、增高垫
  - 婴儿推车：高景观型、轻便折叠型、运动型、双胞胎专用型、旅行系统、慢跑推车
- ✅ 使用场景枚举（城市通勤、户外越野、旅行便携、购物、日常散步）
- ✅ 标准要求核心参数
  - 身高要求（最小/最大值、安装方向、强制后向安装）
  - 重量要求（范围、单位转换）
  - 尺寸要求（i-Size包络、座椅尺寸、头托宽度）
  - 性能要求（碰撞测试G-force、制动性能、避震性能）
  - 安全要求（无尖锐边缘、安全带类型、材料阻燃性）
- ✅ 假人数据（CRABI 12个月、Hybrid III 3岁、Q3s 3岁）

### 1.2 用户输入数据模型

**文件**: `app/src/main/java/com/childproduct/designassistant/model/UserInput.kt`

**功能**:
- ✅ 儿童安全座椅输入
  - 标准选择、产品细分、身高/重量范围、年龄组
  - 自定义特征、专项需求
- ✅ 婴儿推车输入
  - 承重范围、折叠尺寸、使用场景
  - 自定义特征、专项需求
- ✅ 儿童家庭用品输入
- ✅ 输入校验工具类
  - 身高范围校验（格式、正数、反向检查、ECE R129规则）
  - 重量范围校验（格式、正数、反向检查、单位转换）
  - 折叠尺寸校验（格式、车载收纳检查）
- ✅ 常见特征和专项需求列表
- ✅ 输入历史记录模型

### 1.3 设计建议数据模型

**文件**: `app/src/main/java/com/childproduct/designassistant/model/DesignSuggestion.kt`

**功能**:
- ✅ 设计建议报告
  - 功能特征建议（描述、推荐、标准引用、实现难度）
  - 尺寸参数建议（外部/内部尺寸、调节范围、包络合规性）
  - 材料建议（推荐材料、属性、安全评级、供应商）
  - 安全建议（方面、描述、实现、测试要求）
- ✅ 品牌对比
  - 品牌基准（Britax、Maxi-Cosi、Cybex、UPPAbaby等）
  - 技术规格、市场定位、差异化建议
- ✅ DVP测试矩阵
  - 测试项（碰撞测试、耐久性测试、材料测试、化学测试、功能性测试、安全性测试）
  - 标准引用、测试方法、合格标准、测试设备、样本量、测试时长
  - 测试优先级（强制、关键、重要、推荐）
- ✅ 标准合规性检查
- ✅ AI生成请求/响应模型

### 1.4 AI分析与生成服务

**文件**: `app/src/main/java/com/childproduct/designassistant/service/AIAnalysisService.kt`

**功能**:
- ✅ 多模型支持
  - 智谱AI (GLM-4-Flash) - 首选
  - 阿里云通义千问 (Qwen-Plus)
  - 字节跳动豆包
  - DeepSeek API
  - Google Gemini 2.0 Flash
  - Groq API (Llama 3.1)
- ✅ 智能提示词构建
  - 角色定义（儿童产品设计专家）
  - 产品信息（类型、标准）
  - 用户需求（身高、重量、专项需求）
  - 标准要求（参考标准数据）
  - 品牌基准（对比分析）
  - 输出要求（JSON结构）
  - 指导原则（安全性、专业性、可量化）
- ✅ LLM API调用框架
  - 模型选择（基于详情级别）
  - 异步处理（Kotlin Coroutines）
  - 超时控制（30秒）
- ✅ 响应解析与数据转换
  - JSON解析
  - 数据模型转换
- ✅ 默认DVP测试项生成
  - 儿童安全座椅：正面碰撞、侧面碰撞、包络尺寸
  - 婴儿推车：制动性能、折叠耐久性、避震性能
  - 儿童家庭用品：阻燃性、重金属

---

## 第二阶段：用户输入模块优化 🔄 进行中

### 2.1 输入界面优化

**目标文件**:
- `app/src/main/java/com/childproduct/designassistant/ui/screens/HomeScreen.kt`
- `app/src/main/java/com/childproduct/designassistant/ui/screens/SafetyScreen.kt`

**计划内容**:
- ⏳ 创建儿童安全座椅专属输入界面
  - 标准选择下拉菜单（ECE R129、FMVSS 213、GB 27887）
  - 产品细分选择（Group 0+/1/2/3、ISOFIX、便携型等）
  - 核心参数输入（身高范围60-150cm、重量范围22-40lb或kg）
  - 年龄组选择（0-1岁、1-3岁、3-12岁）
  - 特征标签选择（可折叠高景观、后向安装、ISOFIX等）
  - 专项需求输入（文本输入+常见需求快捷选择）
  - 实时校验反馈（输入框下方提示）
- ⏳ 创建婴儿推车专属输入界面
  - 标准选择（EN 1888、ASTM F833）
  - 产品细分选择（高景观、轻便折叠、运动、双胞胎）
  - 核心参数输入（承重范围0-15kg或0-22kg、折叠尺寸50×30×20cm）
  - 使用场景选择（城市通勤、户外越野、旅行便携）
  - 特征标签选择
  - 专项需求输入
- ⏳ 输入历史复用功能
  - 保存最近10条记录
  - 按品类+标准分类
  - 一键复用与编辑

### 2.2 手机端人性化优化

**计划内容**:
- ⏳ 单页分步引导（每步1-2个核心输入项）
- ⏳ 关键按钮底部1/3区域（适配单手操作）
- ⏳ 暗黑/浅色模式自动切换
- ⏳ 底部弹窗选择器（标准选择、产品类型）
- ⏳ 输入联想功能（输入"60cm"自动联想ECE R129 Group 0+）
- ⏳ 一键清空/历史回填快捷操作
- ⏳ 语音输入支持（核心参数）
- ⏳ 标准快速指南（点击"?"弹出悬浮窗）

---

## 第三阶段：数据检索模块优化 📋 待开始

### 3.1 国际标准数据库

**计划内容**:
- ⏳ 扩展SQLite数据库
  - ECE R129/i-Size详细条款
  - FMVSS 213测试要求
  - EN 1888标准参数
  - ASTM F833折叠尺寸限制
- ⏳ 标准数据结构化存储
  - 按品类分类表
  - 标准条款索引
  - 测试方法详情

### 3.2 品牌参数数据库

**计划内容**:
- ⏳ 扩展品牌数据库
  - Britax（SafeCell吸能、头托15档调节、ISOFIX适配）
  - Maxi-Cosi（i-Size Envelope、后向15个月、侧面防护）
  - Cybex（倾斜头托11档、SensorSafe监测）
  - UPPAbaby（折叠53×66×27cm、承重0-15kg、前轮避震）
  - Baby Jogger（越野避震、一键折叠、重量13.6kg）
- ⏳ 品牌数据API接口
  - 品牌官网数据爬取
  - 参数自动更新机制

### 3.3 测试数据检索

**计划内容**:
- ⏳ 假人测试数据
  - Q系列假人参数
  - Hybrid III系列假人
  - 身高/重量/身体尺寸
- ⏳ 耐久性测试数据
  - 折叠次数（≥1000次）
  - 负重15kg推行5km

### 3.4 数据缓存与更新

**计划内容**:
- ⏳ SharedPreferences缓存（有效期7天）
- ⏳ 手动触发数据更新
- ⏳ 网络中断fallback机制

---

## 第四阶段：输出模块优化 📋 待开始

### 4.1 可视化展示

**计划内容**:
- ⏳ 文本展示（设计建议→品牌对比→测试矩阵逻辑排版）
- ⏳ 表格展示（DVP测试矩阵、品牌参数对比，支持横向滚动）
- ⏳ 图像辅助（品牌产品轮播图，点击放大查看）
- ⏳ 核心参数标注（不同颜色区分强制要求）

### 4.2 交互功能

**计划内容**:
- ⏳ 详情查看弹窗（计算逻辑、标准依据）
- ⏳ 二次编辑（一键返回修改参数）
- ⏳ 反馈提交（合理性评分、补充需求）

### 4.3 成果导出

**计划内容**:
- ⏳ PDF导出
  - 集成iTextPDF库
  - 支持精简版/完整版选择
  - 环形进度条展示
  - 立即查看/分享快捷选项
- ⏳ 分享功能
  - Android ShareCompat
  - 支持微信、QQ、邮箱
  - 生成分享链接（有效期7天）
  - 图片质量压缩

### 4.4 离线缓存

**计划内容**:
- ⏳ 建议报告本地缓存
- ⏳ 无网络场景查看

---

## 第五阶段：GitHub Actions自动化构建 📋 待开始

### 5.1 GitHub集成

**计划内容**:
- ⏳ GitHub授权（OAuth2认证）
- ⏳ 权限管控（repo、workflow、packages）
- ⏳ Token加密存储（Android Keystore）
- ⏳ AI操作白名单（指定分支、指定Workflow）

### 5.2 AI驱动的代码管理

**计划内容**:
- ⏳ 代码智能生成
  - 设计建议→Kotlin/Java代码
  - 差异识别
  - 增量更新包
- ⏳ 自动提交与分支管理
  - 指定开发分支（design-suggestion/child-seat、design-suggestion/stroller）
  - 标准化commit说明（【AI自动更新】-品类-功能-版本）
  - 自动发起PR
- ⏳ 更新触发条件
  - 定时触发（每日/每周）
  - 事件触发（重大变更）

### 5.3 AI驱动的自动化构建

**计划内容**:
- ⏳ 智能触发构建
  - AI自动调用GitHub Actions API
  - 构建前校验（语法、兼容性）
- ⏳ 全流程自动化
  - .github/workflows/ai-auto-build-apk.yml
  - 代码拉取、依赖安装、Gradle构建、签名、单元测试
  - Artifacts上传、Releases发布
- ⏳ 构建结果反馈与重试
  - 实时监控构建日志
  - 自动分析失败原因
  - 自动修复并重试
  - 失败推送通知
- ⏳ 大陆友好型优化
  - GitHub亚洲镜像源
  - Gitee仓库集成（备用）

### 5.4 AI驱动的版本管理

**计划内容**:
- ⏳ 语义化版本号自动生成（v1.0.0→v1.0.1）
- ⏳ 更新日志自动维护

---

## 第六阶段：手机端人性化优化 📋 待开始

### 6.1 性能优化

**计划内容**:
- ⏳ 响应速度<5秒（异步处理）
- ⏳ 资源加载优化（图片懒加载、数据分页）
- ⏳ 网络适配（大陆/香港低延迟模型）
- ⏳ 离线缓存机制
- ⏳ 弱网模式（仅加载核心文本）
- ⏳ APK体积<50MB（ProGuard、资源压缩）
- ⏳ 后台运行优化（减少耗电）

### 6.2 交互友好性

**计划内容**:
- ⏳ 手势操作（下拉刷新、左右滑动、双击放大）
- ⏳ 弹窗空白处关闭
- ⏳ 操作反馈（按钮震动、加载进度）

### 6.3 个性化适配

**计划内容**:
- ⏳ 字体大小调节
- ⏳ 暗黑/浅色模式
- ⏳ 常用品类默认选中
- ⏳ 历史记录排序（最近使用）

### 6.4 辅助功能

**计划内容**:
- ⏳ 屏幕朗读（视障用户）
- ⏳ 通知栏推送（构建完成、数据更新）
- ⏳ 点击跳转功能页

### 6.5 扩展性

**计划内容**:
- ⏳ 品类扩展接口（儿童餐椅、安全围栏）
- ⏳ 自定义标准添加（GB 27887）
- ⏳ 模型适配层（新增AI模型）

---

## 技术栈

### 核心技术
- **语言**: Kotlin
- **UI框架**: Jetpack Compose + XML布局（兼容低版本）
- **架构**: MVVM
- **异步处理**: Kotlin Coroutines + Flow
- **数据存储**: SQLite + SharedPreferences
- **网络请求**: Retrofit + OkHttp
- **JSON解析**: org.json

### AI集成
- **首选**: 智谱AI GLM-4-Flash（大陆友好、低延迟）
- **备选**: 通义千问、豆包、DeepSeek、Gemini、Groq
- **离线**: Qwen2.5-3B、Gemma-3 1B（MediaPipe GenAI、llama.cpp）

### 构建
- **构建工具**: Gradle 8.2
- **CI/CD**: GitHub Actions
- **签名**: GitHub Secrets
- **版本管理**: 语义化版本

### 导出
- **PDF**: iTextPDF
- **分享**: Android ShareCompat

---

## 项目进度

### ✅ 已完成（第一阶段）
- [x] 产品标准数据模型
- [x] 用户输入数据模型
- [x] 设计建议数据模型
- [x] AI分析与生成服务

### 🔄 进行中（第二阶段）
- [ ] 用户输入界面优化
- [ ] 手机端人性化优化

### 📋 待开始
- [ ] 数据检索模块优化
- [ ] 输出模块优化
- [ ] GitHub Actions自动化构建
- [ ] 性能优化
- [ ] 交互友好性
- [ ] 个性化适配
- [ ] 辅助功能
- [ ] 扩展性设计

---

## 下一步计划

1. **立即执行**: 优化用户输入界面（HomeScreen、SafetyScreen）
2. **本周完成**: 实现输入校验与历史记录功能
3. **下周计划**: 扩展数据检索模块（国际标准、品牌参数）
4. **迭代优化**: 根据用户反馈持续改进

---

## 注意事项

1. **安全第一**: 所有设计建议严格遵循儿童产品安全规范
2. **数据合规**: 网络请求与数据存储符合GDPR、中国网络安全法
3. **隐私保护**: 云端模型调用需用户授权，本地模式保障隐私
4. **性能优先**: 核心功能响应时间<5秒
5. **兼容性**: 适配Android 10+，兼容华为、小米、OPPO等主流机型
6. **可扩展**: 预留品类扩展接口，支持自定义标准

---

**最后更新**: 2026-01-29
**版本**: v1.0.0-alpha
**状态**: 第一阶段完成，第二阶段进行中
